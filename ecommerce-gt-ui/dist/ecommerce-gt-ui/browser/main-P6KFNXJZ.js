import{$ as ge,A as Y,Aa as le,B as M,Ba as be,C as g,Ca as $e,D as c,Da as L,E as H,F as s,G as b,H as E,I as W,J as y,K as S,L as w,M as k,N as B,O as ce,P as we,Q as j,R as Z,S as ie,T as pe,U as ue,V as D,W as F,X as Re,Z as se,_ as T,a as Ie,aa as Ae,b as ke,ba as V,c as Te,ca as Le,d as xe,da as We,e as Fe,ea as Be,f as Pe,fa as je,g as Ve,ga as fe,h as Ne,ha as De,i as N,ia as z,j as f,ja as $,k as I,ka as ze,l as Oe,la as x,m as h,ma as Ue,n as _,na as O,o as U,oa as R,p as a,pa as ne,q as ye,qa as oe,r as v,ra as A,s as Se,sa as re,t as d,ta as he,u as ae,ua as Ge,va as J,w as o,wa as K,x as r,xa as X,y as p,ya as He,z as q,za as _e}from"./chunk-TC64J5CO.js";var Q=(()=>{class i{constructor(){this.http=f(V),this.router=f(z),this._token=ye(localStorage.getItem("token")),this._nombre=ye(localStorage.getItem("nombre"))}isLoggedIn(){return!!localStorage.getItem("token")}login(e){return this.http.post(`${x.apiBase}/auth/login`,e)}register(e){return this.http.post(`${x.apiBase}/auth/register`,e)}guardarSesion(e){localStorage.setItem("token",e.token??"");let n=e.rolCodigo??e.rol??"COMUN";localStorage.setItem("rol",n),e.nombre&&(localStorage.setItem("nombre",e.nombre),this._nombre.set(e.nombre)),this._token.set(e.token??"")}obtenerRol(){return localStorage.getItem("rol")}get token(){return this._token()}get nombre(){return this._nombre()}logout(){localStorage.removeItem("token"),localStorage.removeItem("rol"),localStorage.removeItem("nombre"),this._token.set(null),this._nombre.set(null),this.router.navigateByUrl("/login")}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function ht(i,m){if(i&1){let e=M();o(0,"div",5)(1,"button",6),g("click",function(){h(e);let t=c();return _(t.auth.logout())}),s(2,"Cerrar sesi\xF3n"),r()()}}function _t(i,m){if(i&1&&(o(0,"div",7)(1,"div",8)(2,"h6",9),p(3,"i",10),s(4," Bienvenido "),o(5,"span",11),s(6),r()(),o(7,"a",12),p(8,"i",13),s(9," Cat\xE1logo "),r(),o(10,"a",14),p(11,"i",15),s(12," Mis productos "),r(),o(13,"a",16),p(14,"i",17),s(15," Nuevo producto "),r(),o(16,"a",18),p(17,"i",19),s(18," Mis compras "),r(),o(19,"a",20),p(20,"i",21),s(21," Mis ganancias "),r()()()),i&2){let e=c();a(6),b(e.auth.nombre||"Usuario")}}var Qe=(()=>{class i{constructor(){this.auth=f(Q),this.router=f(z),this.loggedIn=!1,this.esComun=!1,this.mostrarNavbar=!0}ngOnInit(){this.actualizarEstado(),this.router.events.pipe(Fe(e=>e instanceof je)).subscribe(()=>{this.actualizarEstado()})}actualizarEstado(){let e=this.auth.obtenerRol();this.loggedIn=this.auth.isLoggedIn(),this.esComun=e==="COMUN";let n=this.router.url;this.mostrarNavbar=!n.startsWith("/login")&&!n.startsWith("/register")}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-root"]],standalone:!0,features:[k],decls:7,vars:2,consts:[[1,"navbar","navbar-dark","bg-dark","px-3","d-flex","justify-content-between","align-items-center"],["routerLink","/",1,"navbar-brand","m-0","fw-semibold","text-light"],["class","d-flex align-items-center gap-2",4,"ngIf"],["class","bg-light border-bottom",4,"ngIf"],[1,"container-fluid","p-3"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","btn-sm","btn-danger",3,"click"],[1,"bg-light","border-bottom"],[1,"container","py-2","d-flex","flex-wrap","gap-2"],[1,"m-0"],[1,"bi","bi-person-badge","me-2"],[1,"fw-semibold","text-primary"],["routerLink","/inicio",1,"btn","btn-outline-secondary","btn-sm"],[1,"bi","bi-shop","me-1"],["routerLink","/mis-productos",1,"btn","btn-outline-primary","btn-sm"],[1,"bi","bi-box-seam","me-1"],["routerLink","/mis-productos/nuevo",1,"btn","btn-primary","btn-sm"],[1,"bi","bi-plus-circle","me-1"],["routerLink","/mis-compras",1,"btn","btn-outline-secondary","btn-sm"],[1,"bi","bi-bag-check","me-1"],["routerLink","/mis-ganancias",1,"btn","btn-outline-secondary","btn-sm"],[1,"bi","bi-cash-coin","me-1"]],template:function(n,t){n&1&&(o(0,"nav",0)(1,"a",1),s(2,"E-Commerce\xB7GT"),r(),v(3,ht,3,0,"div",2),r(),v(4,_t,22,1,"div",3),o(5,"main",4),p(6,"router-outlet"),r()),n&2&&(a(3),d("ngIf",t.loggedIn&&t.mostrarNavbar),a(),d("ngIf",t.loggedIn&&t.esComun&&t.mostrarNavbar))},dependencies:[T,F,De,$]})}}return i})();function bt(i,m){if(i&1&&(o(0,"p",14),s(1),r()),i&2){let e=c();a(),b(e.error)}}var qe=(()=>{class i{constructor(){this.correo="",this.password="",this.loading=!1,this.error="",this.auth=f(Q),this.router=f(z)}onSubmit(e){e.invalid||(this.loading=!0,this.error="",this.auth.login({correo:this.correo,password:this.password}).subscribe({next:n=>{this.loading=!1,this.auth.guardarSesion(n);let t=n.rolCodigo??n.rol??"COMUN";switch(console.log("Rol del usuario:",t),t){case"ADMIN":this.router.navigateByUrl("/admin/empleados");break;case"MODERADOR":this.router.navigateByUrl("/moderador/solicitudes");break;case"LOGISTICA":this.router.navigateByUrl("/logistica/pendientes");break;default:this.router.navigateByUrl("/inicio");break}},error:n=>{this.loading=!1,this.error=n?.error?.message??"Credenciales inv\xE1lidas"}}))}ngOnInit(){localStorage.removeItem("token")}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-login"]],standalone:!0,features:[k],decls:22,vars:5,consts:[["f","ngForm"],[1,"login-page"],[1,"overlay"],[1,"login-card"],[1,"subtitle"],["autocomplete","off",3,"ngSubmit"],[1,"form-group"],["for","correo"],["id","correo","name","correo","required","","type","email",3,"ngModelChange","ngModel"],["for","password"],["id","password","name","password","required","","type","password",3,"ngModelChange","ngModel"],[1,"btn-primary",3,"disabled"],["class","error",4,"ngIf"],["routerLink","/register",1,"link"],[1,"error"]],template:function(n,t){if(n&1){let l=M();o(0,"div",1),p(1,"div",2),o(2,"div",3)(3,"h1"),s(4,"Bienvenido"),r(),o(5,"p",4),s(6,"Ingresa a tu cuenta"),r(),o(7,"form",5,0),g("ngSubmit",function(){h(l);let C=H(8);return _(t.onSubmit(C))}),o(9,"div",6)(10,"label",7),s(11,"Correo"),r(),o(12,"input",8),w("ngModelChange",function(C){return h(l),S(t.correo,C)||(t.correo=C),_(C)}),r()(),o(13,"div",6)(14,"label",9),s(15,"Contrase\xF1a"),r(),o(16,"input",10),w("ngModelChange",function(C){return h(l),S(t.password,C)||(t.password=C),_(C)}),r()(),o(17,"button",11),s(18),r(),v(19,bt,2,1,"p",12),o(20,"a",13),s(21,"\xBFNo tienes cuenta? Reg\xEDstrate"),r()()()()}if(n&2){let l=H(8);a(12),y("ngModel",t.correo),a(4),y("ngModel",t.password),a(),d("disabled",t.loading||l.invalid),a(),E(" ",t.loading?"Ingresando\u2026":"Iniciar sesi\xF3n"," "),a(),d("ngIf",t.error)}},dependencies:[T,F,L,re,O,R,ne,le,A,oe,$],styles:['@charset "UTF-8";.login-page[_ngcontent-%COMP%]{position:relative;min-height:100dvh;display:grid;place-items:center;background:url(/assets/fondo6.jpeg) center/cover no-repeat fixed}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(180deg,#00000059,#0000008c)}.login-card[_ngcontent-%COMP%]{position:relative;z-index:1;width:min(420px,92vw);padding:2rem;border-radius:18px;-webkit-backdrop-filter:blur(9px);backdrop-filter:blur(9px);background:#ffffff29;box-shadow:0 10px 30px #00000040;color:#fff}.login-card[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:0 0 .25rem;font-weight:700;letter-spacing:.2px}.login-card[_ngcontent-%COMP%]   .subtitle[_ngcontent-%COMP%]{margin:0 0 1.25rem;opacity:.85}.login-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:grid;gap:.35rem;margin-bottom:.9rem}.login-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.9rem;opacity:.95}.login-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:none;outline:none;padding:.8rem .9rem;border-radius:12px;background:#ffffffe6;color:#111;transition:box-shadow .2s ease}.login-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{box-shadow:0 0 0 3px #6366f159}.login-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{width:100%;border:0;padding:.85rem 1rem;border-radius:12px;font-weight:600;cursor:pointer;background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;transition:transform .05s ease,filter .2s ease}.login-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:hover{filter:brightness(1.05)}.login-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:active{transform:translateY(1px)}.login-card[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:default}.login-card[_ngcontent-%COMP%]   .error[_ngcontent-%COMP%]{margin-top:.75rem;background:#ef44442e;border:1px solid rgba(239,68,68,.45);color:#fee2e2;border-radius:10px;padding:.6rem .8rem;font-size:.9rem}.login-card[_ngcontent-%COMP%]   .link[_ngcontent-%COMP%]{display:inline-block;margin-top:1rem;color:#c7d2fe;text-decoration:underline}']})}}return i})();function vt(i,m){if(i&1&&(o(0,"div",23),s(1),r()),i&2){let e=c();a(),b(e.error)}}var Ye=(()=>{class i{constructor(){this.nombre="",this.correo="",this.telefono="",this.password="",this.confirmar="",this.loading=!1,this.error="",this.auth=f(Q),this.router=f(z)}onSubmit(e){if(!e.invalid){if(this.password!==this.confirmar){this.error="Las contrase\xF1as no coinciden";return}this.loading=!0,this.error="",this.auth.register({nombre:this.nombre,correo:this.correo,telefono:this.telefono,password:this.password}).subscribe({next:n=>{this.loading=!1,alert("\xA1Cuenta creada! Ahora puedes iniciar sesi\xF3n."),this.router.navigateByUrl("/login")},error:n=>{this.loading=!1,this.error=n?.error?.message??"No se pudo registrar"}})}}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-register"]],standalone:!0,features:[k],decls:36,vars:8,consts:[["f","ngForm"],[1,"row","justify-content-center"],[1,"col-12","col-md-7","col-lg-6"],[1,"card","shadow-sm"],[1,"card-body","p-4"],[1,"mb-3","text-center"],["novalidate","",3,"ngSubmit"],[1,"mb-3"],["for","nombre",1,"form-label"],["id","nombre","name","nombre","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","correo",1,"form-label"],["id","correo","name","correo","type","email","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","telefono",1,"form-label"],["id","telefono","name","telefono",1,"form-control",3,"ngModelChange","ngModel"],["for","password",1,"form-label"],["id","password","name","password","type","password","required","","minlength","4",1,"form-control",3,"ngModelChange","ngModel"],["for","confirmar",1,"form-label"],["id","confirmar","name","confirmar","type","password","required","","minlength","4",1,"form-control",3,"ngModelChange","ngModel"],[1,"btn","btn-success","w-100",3,"disabled"],["class","text-danger mt-3",4,"ngIf"],[1,"my-4"],[1,"text-center","mb-0"],["routerLink","/login"],[1,"text-danger","mt-3"]],template:function(n,t){if(n&1){let l=M();o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3",5),s(5,"Crear cuenta"),r(),o(6,"form",6,0),g("ngSubmit",function(){h(l);let C=H(7);return _(t.onSubmit(C))}),o(8,"div",7)(9,"label",8),s(10,"Nombre completo"),r(),o(11,"input",9),w("ngModelChange",function(C){return h(l),S(t.nombre,C)||(t.nombre=C),_(C)}),r()(),o(12,"div",7)(13,"label",10),s(14,"Correo"),r(),o(15,"input",11),w("ngModelChange",function(C){return h(l),S(t.correo,C)||(t.correo=C),_(C)}),r()(),o(16,"div",7)(17,"label",12),s(18,"Tel\xE9fono"),r(),o(19,"input",13),w("ngModelChange",function(C){return h(l),S(t.telefono,C)||(t.telefono=C),_(C)}),r()(),o(20,"div",7)(21,"label",14),s(22,"Contrase\xF1a"),r(),o(23,"input",15),w("ngModelChange",function(C){return h(l),S(t.password,C)||(t.password=C),_(C)}),r()(),o(24,"div",7)(25,"label",16),s(26,"Confirmar contrase\xF1a"),r(),o(27,"input",17),w("ngModelChange",function(C){return h(l),S(t.confirmar,C)||(t.confirmar=C),_(C)}),r()(),o(28,"button",18),s(29),r(),v(30,vt,2,1,"div",19),r(),p(31,"hr",20),o(32,"p",21),s(33," \xBFYa tienes cuenta? "),o(34,"a",22),s(35,"Iniciar sesi\xF3n"),r()()()()()()}if(n&2){let l=H(7);a(11),y("ngModel",t.nombre),a(4),y("ngModel",t.correo),a(4),y("ngModel",t.telefono),a(4),y("ngModel",t.password),a(4),y("ngModel",t.confirmar),a(),d("disabled",l.invalid||t.loading),a(),E(" ",t.loading?"Creando...":"Crear cuenta"," "),a(),d("ngIf",t.error)}},dependencies:[T,F,L,re,O,R,ne,le,be,A,oe],styles:[".card[_ngcontent-%COMP%]{border-radius:1rem}"]})}}return i})();var Ze=()=>{let i=f(z);return localStorage.getItem("rol")==="ADMIN"?!0:i.createUrlTree(["/login"])};var ve=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/admin/empleados`}listar(e,n,t){let l=new Ae().set("pagina",e).set("tamanio",n);return t?.nombre&&t.nombre.trim()&&(l=l.set("nombre",t.nombre.trim())),t?.rol&&t.rol!=="TODOS"&&(l=l.set("rol",t.rol)),this.http.get(`${x.apiBase}/admin/empleados`,{params:l})}crear(e){return this.http.post(this.base,e)}get(e){return this.http.get(`${this.base}/${e}`)}actualizar(e,n){return this.http.put(`${this.base}/${e}`,n)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ct=()=>["/admin/reportes"],xt=()=>["/admin/ganancias"],yt=()=>["/admin/empleados/crear"],St=i=>["/admin/empleados",i,"editar"];function wt(i,m){if(i&1&&(o(0,"tr")(1,"td"),s(2),r(),o(3,"td"),s(4),r(),o(5,"td"),s(6),r(),o(7,"td"),s(8),r(),o(9,"td")(10,"span",42),s(11),r()(),o(12,"td")(13,"span",43),s(14),r()(),o(15,"td")(16,"button",44),p(17,"i",45),r()()()),i&2){let e=m.$implicit;a(2),b(e.id),a(2),b(e.nombre),a(2),b(e.correo),a(2),b(e.telefono),a(3),b(e.rol),a(2),d("ngClass",e.activo?"bg-success":"bg-danger"),a(),E(" ",e.activo?"Activo":"Inactivo"," "),a(2),d("routerLink",ce(8,St,e.id))}}function Et(i,m){i&1&&(o(0,"tr")(1,"td",46),s(2,"Sin registros"),r()())}var Je=(()=>{class i{constructor(){this.service=f(ve),this.auth=f(Q),this.adminNombre="",this.empleados=[],this.pagina=0,this.tamanio=10,this.total=0,this.totalPaginas=0,this.nombre="",this.rol="TODOS",this.nombreInput$=new xe,this.destroy$=new xe}ngOnInit(){this.cargar(),this.nombreInput$.pipe(Pe(300),Ve(),Ne(this.destroy$)).subscribe(e=>{this.nombre=e,this.pagina=0,this.cargar()})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}onNombreChange(e){this.nombreInput$.next(e)}onRolChange(){this.pagina=0,this.cargar()}cargar(){this.service.listar(this.pagina,this.tamanio,{nombre:this.nombre,rol:this.rol}).subscribe(e=>{this.empleados=e.content,this.total=e.totalElements,this.totalPaginas=e.totalPages,this.pagina=e.number})}buscar(){this.pagina=0,this.cargar()}limpiar(){this.nombre="",this.rol="TODOS",this.buscar()}next(){this.pagina+1<this.totalPaginas&&(this.pagina++,this.cargar())}prev(){this.pagina>0&&(this.pagina--,this.cargar())}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-empleados-listar"]],standalone:!0,features:[k],decls:79,vars:16,consts:[[1,"container","py-4"],[1,"m-0"],[1,"bi","bi-person-badge","me-2"],[1,"fw-semibold","text-primary"],[1,"card","shadow-sm","border-0","rounded-3","mb-3"],[1,"card-header","bg-primary","text-white","d-flex","align-items-center","justify-content-between"],[1,"mb-0"],[1,"bi","bi-people","me-2"],[1,"badge","bg-light","text-dark","me-3"],[1,"btn","btn-info","btn-sm","fw-semibold",3,"routerLink"],[1,"bi","bi-graph-up-arrow","me-1"],[1,"btn","btn-warning","btn-sm","fw-semibold",3,"routerLink"],[1,"bi","bi-cash-coin","me-1"],[1,"btn","btn-light","btn-sm","fw-semibold",3,"routerLink"],[1,"bi","bi-plus-circle","me-1"],[1,"card-body","py-3"],[1,"row","g-2","align-items-end"],[1,"col-12","col-md-4"],[1,"form-label"],["type","text","placeholder","Ej. Marco, Karen\u2026","name","nombre",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-12","col-md-3"],["name","rol",1,"form-select",3,"ngModelChange","change","ngModel"],["value","TODOS"],["value","ADMIN"],["value","MODERADOR"],["value","LOGISTICA"],["value","COMUN"],[1,"col-12","col-md-5","d-flex","gap-2"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-eraser","me-1"],[1,"card-body","p-3"],[1,"table-responsive"],[1,"table","table-hover","align-middle"],[1,"table-secondary"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"card-footer","d-flex","justify-content-between","align-items-center"],[1,"text-muted","small"],[1,"d-flex","gap-2"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-chevron-left"],[1,"bi","bi-chevron-right"],[1,"badge","bg-dark"],[1,"badge",3,"ngClass"],[1,"btn","btn-outline-secondary","btn-sm",3,"routerLink"],[1,"bi","bi-pencil"],["colspan","7",1,"text-center","text-muted","py-4"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"h6",1),p(2,"i",2),s(3," Bienvenido "),o(4,"span",3),s(5),r()(),o(6,"div",4)(7,"div",5)(8,"h5",6),p(9,"i",7),s(10,"Gesti\xF3n de Usuarios"),r(),o(11,"div")(12,"span",8),s(13," Total: "),o(14,"strong"),s(15),r()(),o(16,"a",9),p(17,"i",10),s(18," Reportes "),r(),o(19,"a",11),p(20,"i",12),s(21," Ver Ganancias "),r(),o(22,"a",13),p(23,"i",14),s(24," Nuevo Empleado "),r()()(),o(25,"div",15)(26,"form",16)(27,"div",17)(28,"label",18),s(29,"Buscar por nombre"),r(),o(30,"input",19),w("ngModelChange",function(u){return S(t.nombre,u)||(t.nombre=u),u}),g("ngModelChange",function(u){return t.onNombreChange(u)}),r()(),o(31,"div",20)(32,"label",18),s(33,"Rol"),r(),o(34,"select",21),w("ngModelChange",function(u){return S(t.rol,u)||(t.rol=u),u}),g("change",function(){return t.onRolChange()}),o(35,"option",22),s(36,"Todos"),r(),o(37,"option",23),s(38,"Admin"),r(),o(39,"option",24),s(40,"Moderador"),r(),o(41,"option",25),s(42,"Log\xEDstica"),r(),o(43,"option",26),s(44,"Com\xFAn"),r()()(),o(45,"div",27)(46,"button",28),g("click",function(){return t.limpiar()}),p(47,"i",29),s(48," Limpiar "),r()()()()(),o(49,"div",30)(50,"div",31)(51,"table",32)(52,"thead",33)(53,"tr")(54,"th"),s(55,"ID"),r(),o(56,"th"),s(57,"Nombre"),r(),o(58,"th"),s(59,"Correo"),r(),o(60,"th"),s(61,"Tel\xE9fono"),r(),o(62,"th"),s(63,"Rol"),r(),o(64,"th"),s(65,"Estado"),r(),o(66,"th"),s(67,"Acci\xF3n"),r()()(),o(68,"tbody"),v(69,wt,18,10,"tr",34)(70,Et,3,0,"tr",35),r()()(),o(71,"div",36)(72,"span",37),s(73),r(),o(74,"div",38)(75,"button",39),g("click",function(){return t.prev()}),p(76,"i",40),r(),o(77,"button",39),g("click",function(){return t.next()}),p(78,"i",41),r()()()()()),n&2&&(a(5),b(t.auth.nombre||"Admin"),a(10),b(t.total),a(),d("routerLink",B(13,Ct)),a(3),d("routerLink",B(14,xt)),a(3),d("routerLink",B(15,yt)),a(8),y("ngModel",t.nombre),a(4),y("ngModel",t.rol),a(35),d("ngForOf",t.empleados),a(),d("ngIf",t.empleados.length===0),a(3),W("P\xE1gina ",t.pagina+1," / ",t.totalPaginas,""),a(2),d("disabled",t.pagina===0),a(2),d("disabled",t.pagina+1>=t.totalPaginas))},dependencies:[T,ue,D,F,L,re,K,X,O,J,R,ne,A,oe,$],encapsulation:2})}}return i})();var Mt=()=>["/admin/empleados"];function It(i,m){i&1&&(o(0,"div",7)(1,"label",8),s(2,"Rol"),r(),p(3,"input",19),o(4,"div",20),s(5,"El rol de un usuario com\xFAn no se puede modificar."),r()()),i&2&&(a(3),d("value","COMUN"))}function kt(i,m){if(i&1){let e=M();o(0,"div",7)(1,"label",8),s(2,"Rol"),r(),o(3,"select",21),w("ngModelChange",function(t){h(e);let l=c();return S(l.rolCodigo,t)||(l.rolCodigo=t),_(t)}),o(4,"option",22),s(5,"MODERADOR"),r(),o(6,"option",23),s(7,"LOGISTICA"),r(),o(8,"option",24),s(9,"ADMIN"),r()()()}if(i&2){let e=c();a(3),y("ngModel",e.rolCodigo),d("required",!e.rolBloqueado)}}function Tt(i,m){i&1&&(o(0,"small",25),s(1,"(no editable en edici\xF3n)"),r())}function Ft(i,m){if(i&1&&(o(0,"div",26),s(1),r()),i&2){let e=c();a(),b(e.error)}}var Ee=(()=>{class i{constructor(){this.route=f(fe),this.router=f(z),this.api=f(ve),this.nombre="",this.correo="",this.telefono="",this.rolCodigo="MODERADOR",this.contrasena="",this.loading=!1,this.error="",this.rolBloqueado=!1}ngOnInit(){let e=this.route.snapshot.paramMap.get("id");e&&(this.editId=+e,this.cargarEmpleado(this.editId))}cargarEmpleado(e){this.loading=!0,this.api.get(e).subscribe({next:n=>{this.nombre=n.nombre??"",this.correo=n.correo??"",this.telefono=n.telefono??"",this.rolCodigo=n.rol,this.rolCodigo=n.rol??"COMUN",this.rolBloqueado=n.rol==="COMUN",this.loading=!1},error:n=>{this.loading=!1,this.error="No se pudo cargar el empleado"}})}enviar(e){if(e.invalid)return;this.loading=!0,this.error="";let n={nombre:this.nombre.trim(),correo:this.correo.trim(),telefono:this.telefono?.trim()};this.rolBloqueado||(n.rolCodigo=this.rolCodigo),this.editId||(n.contrasena=this.contrasena),(this.editId?this.api.actualizar(this.editId,n):this.api.crear(n)).subscribe({next:l=>{this.loading=!1,this.router.navigateByUrl("/admin/empleados")},error:l=>{this.loading=!1,this.error="No se pudo guardar"}})}get esEdicion(){return!!this.editId}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-empleado-crear"]],standalone:!0,features:[k],decls:33,vars:15,consts:[["f","ngForm"],["rolEditable",""],[1,"container","py-4"],[1,"mb-3"],[1,"bi","bi-person-plus-fill","me-2"],["novalidate","",3,"ngSubmit"],[1,"row","g-3"],[1,"col-md-6"],[1,"form-label"],["name","nombre","required","",1,"form-control",3,"ngModelChange","ngModel"],["type","email","name","correo","required","",1,"form-control",3,"ngModelChange","ngModel"],["name","telefono",1,"form-control",3,"ngModelChange","ngModel"],["class","col-md-6",4,"ngIf","ngIfElse"],["class","text-muted",4,"ngIf"],["type","password","name","password","minlength","4",1,"form-control",3,"ngModelChange","ngModel","required","disabled"],[1,"mt-3","d-flex","gap-2"],[1,"btn","btn-primary",3,"disabled"],[1,"btn","btn-outline-secondary",3,"routerLink"],["class","text-danger mt-3",4,"ngIf"],["disabled","",1,"form-control",3,"value"],[1,"form-text"],["name","rolCodigo",1,"form-select",3,"ngModelChange","ngModel","required"],["value","MODERADOR"],["value","LOGISTICA"],["value","ADMIN"],[1,"text-muted"],[1,"text-danger","mt-3"]],template:function(n,t){if(n&1){let l=M();o(0,"div",2)(1,"h3",3),p(2,"i",4),s(3),r(),o(4,"form",5,0),g("ngSubmit",function(){h(l);let C=H(5);return _(t.enviar(C))}),o(6,"div",6)(7,"div",7)(8,"label",8),s(9,"Nombre"),r(),o(10,"input",9),w("ngModelChange",function(C){return h(l),S(t.nombre,C)||(t.nombre=C),_(C)}),r()(),o(11,"div",7)(12,"label",8),s(13,"Correo"),r(),o(14,"input",10),w("ngModelChange",function(C){return h(l),S(t.correo,C)||(t.correo=C),_(C)}),r()(),o(15,"div",7)(16,"label",8),s(17,"Tel\xE9fono"),r(),o(18,"input",11),w("ngModelChange",function(C){return h(l),S(t.telefono,C)||(t.telefono=C),_(C)}),r()(),v(19,It,6,1,"div",12)(20,kt,10,2,"ng-template",null,1,pe),o(22,"div",7)(23,"label",8),s(24," Contrase\xF1a "),v(25,Tt,2,0,"small",13),r(),o(26,"input",14),w("ngModelChange",function(C){return h(l),S(t.contrasena,C)||(t.contrasena=C),_(C)}),r()()(),o(27,"div",15)(28,"button",16),s(29),r(),o(30,"a",17),s(31,"Cancelar"),r()(),v(32,Ft,2,1,"div",18),r()()}if(n&2){let l=H(5),u=H(21);a(3),E(" ",t.esEdicion?"Editar Empleado":"Registrar Nuevo Empleado"," "),a(7),y("ngModel",t.nombre),a(4),y("ngModel",t.correo),a(4),y("ngModel",t.telefono),a(),d("ngIf",t.rolBloqueado)("ngIfElse",u),a(6),d("ngIf",t.esEdicion),a(),y("ngModel",t.contrasena),d("required",!t.esEdicion)("disabled",t.esEdicion),a(2),d("disabled",l.invalid||t.loading),a(),E(" ",t.loading?"Guardando...":t.esEdicion?"Actualizar":"Guardar"," "),a(),d("routerLink",B(14,Mt)),a(2),d("ngIf",t.error)}},dependencies:[T,F,L,re,K,X,O,J,R,ne,le,be,A,oe,$],encapsulation:2})}}return i})();var de=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/productos`}listarPublico(e=0,n=12){return this.http.get(`${this.base}/publico`,{params:{pagina:e,tamanio:n}})}listarMisProductos(e=0,n=10){return this.http.get(`${this.base}/mis`,{params:{pagina:e,tamanio:n}})}crear(e,n){let t=new FormData;return t.append("dto",new Blob([JSON.stringify(e)],{type:"application/json"})),n&&t.append("imagen",n),this.http.post(`${this.base}/mis`,t)}actualizar(e,n,t){let l=new FormData;return l.append("dto",new Blob([JSON.stringify(n)],{type:"application/json"})),t&&l.append("imagen",t),this.http.put(`${this.base}/mis/${e}`,l)}mis(e=0,n=12){return this.listarMisProductos(e,n)}obtenerMio(e){return this.http.get(`${this.base}/mis/${e}`)}obtenerResenas(e){return this.http.get(`${this.base}/${e}/resenas`)}crearResena(e,n){return this.http.post(`${this.base}/${e}/resenas`,n)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ce=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/carrito`}tarjetas(){return this.http.get(`${this.base}/tarjetas`,{headers:this.authHeaders()})}simularTokenPasarela(){return"SIM-"+Date.now()+"-"+Math.random().toString(36).slice(2,8).toUpperCase()}authHeaders(){let e=localStorage.getItem("token");return new ge({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})}ver(){return this.http.get(this.base,{headers:this.authHeaders()})}agregar(e,n=1){return this.http.post(`${this.base}/agregar`,{productoId:e,cantidad:n},{headers:this.authHeaders()})}actualizar(e,n){return this.http.put(`${this.base}/item`,{productoId:e,cantidad:n},{headers:this.authHeaders()})}eliminar(e){return this.http.delete(`${this.base}/item/${e}`,{headers:this.authHeaders()})}vaciar(){return this.http.delete(this.base,{headers:this.authHeaders()})}checkout(e){return this.http.post(`${this.base}/checkout`,e,{headers:this.authHeaders()})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ke=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/productos`}listar(e){return this.http.get(`${this.base}/${e}/reviews`)}crear(e,n,t){return this.http.post(`${this.base}/${e}/reviews`,{rating:n,comentario:t})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var ee=(()=>{class i{transform(e){return e?e.startsWith("/uploads/")?e:"/uploads/"+e.replace(/^\/+/,""):"assets/noimg.png"}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275pipe=Oe({name:"imgUrl",type:i,pure:!0,standalone:!0})}}return i})();var me=()=>[],Pt=()=>[1,2,3,4,5];function Vt(i,m){if(i&1&&(o(0,"option",12),s(1),r()),i&2){let e=m.$implicit;d("value",e),a(),b(e)}}function Nt(i,m){i&1&&(q(0),s(1,"\u2605"),Y())}function Ot(i,m){i&1&&(q(0),s(1,"\u2606"),Y())}function Rt(i,m){if(i&1){let e=M();q(0),o(1,"span",51),g("click",function(){let t=h(e).$implicit,l=c(4);return _(l.seleccionarEstrella(t))}),s(2),r(),Y()}if(i&2){let e=m.$implicit,n=c(4);a(2),b(e<=n.miRating?"\u2605":"\u2606")}}function At(i,m){if(i&1){let e=M();o(0,"div",45)(1,"div",46)(2,"span",33),s(3,"Tu calificaci\xF3n:"),r(),o(4,"span",47),v(5,Rt,3,1,"ng-container",35),r()(),o(6,"textarea",48),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.miComentario,t)||(l.miComentario=t),_(t)}),r(),o(7,"div",49)(8,"button",50),g("click",function(){h(e);let t=c(3);return _(t.enviarResena())}),s(9," Enviar rese\xF1a "),r()()()}if(i&2){let e=c(3);a(5),d("ngForOf",B(3,Pt)),a(),y("ngModel",e.miComentario),a(2),d("disabled",e.miRating<1||!e.miComentario.trim())}}function Lt(i,m){i&1&&(o(0,"div",52),p(1,"div",53),r())}function Wt(i,m){i&1&&(o(0,"div",54),s(1," A\xFAn no hay rese\xF1as para este producto. "),r())}function Bt(i,m){i&1&&(q(0),s(1,"\u2605"),Y())}function jt(i,m){i&1&&(q(0),s(1,"\u2606"),Y())}function Dt(i,m){if(i&1&&(o(0,"div",57)(1,"div",58)(2,"div",31),s(3),r(),o(4,"div",34),v(5,Bt,2,0,"ng-container",35)(6,jt,2,0,"ng-container",35),r()(),o(7,"div",59),s(8),r()()),i&2){let e=m.$implicit,n=c(4);a(3),b(e.usuario),a(2),d("ngForOf",B(4,me).constructor(n.Math.floor(e.rating||0))),a(),d("ngForOf",B(5,me).constructor(5-n.Math.floor(e.rating||0))),a(2),b(e.comentario)}}function zt(i,m){if(i&1&&(o(0,"div",55),v(1,Dt,9,6,"div",56),r()),i&2){let e=c(3);a(),d("ngForOf",e.resenas)}}function Ut(i,m){if(i&1){let e=M();o(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"div")(5,"div",31),s(6),r(),o(7,"div",32),s(8," Promedio: "),o(9,"span",33),s(10),r(),o(11,"span",34),v(12,Nt,2,0,"ng-container",35)(13,Ot,2,0,"ng-container",35),r(),o(14,"span",36),s(15),r()()(),o(16,"button",37),g("click",function(){h(e);let t=c(2);return _(t.cerrarResenas())}),r()(),o(17,"div",38),v(18,At,10,4,"div",39)(19,Lt,2,0,"div",40)(20,Wt,2,0,"div",41)(21,zt,2,1,"div",42),r(),o(22,"div",43)(23,"button",44),g("click",function(){h(e);let t=c(2);return _(t.cerrarResenas())}),s(24,"Cerrar"),r()()()()()}if(i&2){let e=c(2);a(6),E("Rese\xF1as \xB7 ",e.productoSeleccionado==null?null:e.productoSeleccionado.nombre,""),a(4),E("",e.fmt1(e.promedio),"/5"),a(2),d("ngForOf",B(9,me).constructor(e.estrellas(e.promedio).enteras)),a(),d("ngForOf",B(10,me).constructor(e.estrellas(e.promedio).vacias)),a(2),E("(",e.totalResenas,")"),a(3),d("ngIf",e.puedeComentar),a(),d("ngIf",e.cargandoResenas),a(),d("ngIf",!e.cargandoResenas&&e.resenas.length===0),a(),d("ngIf",!e.cargandoResenas&&e.resenas.length>0)}}function Gt(i,m){i&1&&(q(0),s(1,"\u2605"),Y())}function Ht(i,m){i&1&&(q(0),s(1,"\u2606"),Y())}function $t(i,m){if(i&1&&(o(0,"div",60)(1,"span",34),v(2,Gt,2,0,"ng-container",35)(3,Ht,2,0,"ng-container",35),r(),o(4,"span",61),s(5),r()()),i&2){let e=c().$implicit,n=c();a(2),d("ngForOf",B(3,me).constructor(n.estrellas(e.ratingPromedio).enteras)),a(),d("ngForOf",B(4,me).constructor(n.estrellas(e.ratingPromedio).vacias)),a(2),E("(",e.totalResenas||0,")")}}function Qt(i,m){i&1&&(o(0,"span",62),s(1,"Agotado"),r())}function qt(i,m){i&1&&(o(0,"span",63),s(1,"\xA1\xDAltima unidad!"),r())}function Yt(i,m){if(i&1){let e=M();o(0,"div",7)(1,"div",13),p(2,"img",14),j(3,"imgUrl"),v(4,Ut,25,11,"div",15),o(5,"div",16)(6,"h6",17),s(7),r(),o(8,"div",18),s(9),r(),v(10,$t,6,5,"div",19),o(11,"div",20),s(12),r(),o(13,"button",21),g("click",function(){let t=h(e).$implicit,l=c();return _(l.abrirResenas(t))}),p(14,"i",22),s(15," Ver rese\xF1as "),r(),o(16,"button",23),g("click",function(){let t=h(e).$implicit,l=c();return _(l.addToCart(t.id))}),p(17,"i",24),s(18," Agregar "),r()(),v(19,Qt,2,0,"span",25)(20,qt,2,0,"span",26),r()()}if(i&2){let e,n=m.$implicit,t=c();a(2),d("src",Z(3,11,(e=n.imagenUrl)!==null&&e!==void 0?e:null),U),a(2),d("ngIf",t.showResenas),a(3),W("",n.nombre," | Stock: ",n.stock,""),a(2),W("",n.categoria," \xB7 ",n.estadoArticulo,""),a(),d("ngIf",n.ratingPromedio!==void 0),a(2),b(t.asQ(n.precioCents)),a(4),d("disabled",n.stock<=0),a(3),d("ngIf",n.stock==0),a(),d("ngIf",n.stock==1)}}var Xe=(()=>{class i{constructor(){this.svc=f(de),this.carrito=f(Ce),this.router=f(z),this.reviewsSvc=f(Ke),this.Math=Math,this.backendOrigin=x.backendOrigin||"https://interbelligerent-torie-nonstoically.ngrok-free.dev",this.productos=[],this.filtrados=[],this.filtroNombre="",this.filtroCategoria="Todos",this.categorias=["Todos","Tecnolog\xEDa","Hogar","Acad\xE9mico","Personal","Decoraci\xF3n","Otro"],this.showResenas=!1,this.resenas=[],this.promedio=0,this.totalResenas=0,this.puedeComentar=!1,this.cargandoResenas=!1,this.miRating=0,this.miComentario=""}ngOnInit(){this.cargar()}fullImg(e){let n=e?.imagenUrl??e?.imageUrl??null;return n?n.startsWith("/uploads/")?n:"/uploads/"+n.replace(/^\/+/,""):"assets/noimg.png"}cargar(){this.productos=[];let e=50,n=0,t=()=>{this.svc.listarPublico(n,e).subscribe({next:l=>{this.productos.push(...l.content),n+1<l.totalPages?(n++,t()):this.aplicarFiltro()},error:l=>console.error("Error cargando productos",l)})};t()}fmt1(e){return(Math.round((e||0)*10)/10).toFixed(1)}estrellas(e){e=e||0;let n=Math.floor(e);return{enteras:n,vacias:5-n}}abrirResenas(e){this.productoSeleccionado=e,this.showResenas=!0,this.cargarResenas(e.id)}cerrarResenas(){this.showResenas=!1}cargarResenas(e,n=!1){this.cargandoResenas=!0,this.reviewsSvc.listar(e).subscribe({next:t=>{this.promedio=t.promedio||0,this.totalResenas=t.total||0,this.puedeComentar=t.puedeComentar,this.resenas=t.items,n&&this.syncProductoCalificacion(e,this.promedio,this.totalResenas),this.cargandoResenas=!1},error:t=>this.cargandoResenas=!1})}seleccionarEstrella(e){this.miRating=e}enviarResena(){!this.productoSeleccionado||this.miRating<1||!this.miComentario.trim()||this.reviewsSvc.crear(this.productoSeleccionado.id,this.miRating,this.miComentario.trim()).subscribe({next:e=>{this.cargarResenas(this.productoSeleccionado.id,!0),this.miRating=0,this.miComentario="",this.cargarResenas(this.productoSeleccionado.id),this.productoSeleccionado.totalResenas=(this.productoSeleccionado.totalResenas||0)+1},error:e=>alert(e?.error?.message||"No se pudo enviar la rese\xF1a")})}syncProductoCalificacion(e,n,t){let l=u=>u.id===e?ke(Ie({},u),{ratingPromedio:n,totalResenas:t}):u;this.productos=this.productos.map(l),this.filtrados=this.filtrados.map(l)}aplicarFiltro(){let e=this.filtroNombre.toLowerCase(),n=this.filtroCategoria;this.filtrados=this.productos.filter(t=>{let l=t.nombre.toLowerCase().includes(e),u=n==="Todos"||t.categoria===n;return l&&u})}addToCart(e){this.carrito.agregar(e,1).subscribe({next:n=>this.router.navigateByUrl("/carrito"),error:n=>alert("No se pudo agregar al carrito")})}asQ(e){return e.toLocaleString("es-GT",{style:"currency",currency:"GTQ"})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-catalogo"]],standalone:!0,features:[k],decls:14,vars:5,consts:[[1,"container","py-4"],[1,"mb-3"],[1,"bi","bi-shop","me-2"],[1,"badge","bg-primary","ms-2"],[1,"row","mb-4","g-2","align-items-center"],[1,"col-md-4"],["type","text","placeholder","Buscar por nombre...",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"row","g-3"],["class","col-md-3",4,"ngFor","ngForOf"],[3,"value"],[1,"card","h-100","shadow-sm"],["loading","lazy","referrerpolicy","no-referrer",1,"card-img-top",2,"object-fit","cover",3,"src"],["class","modal fade show","tabindex","-1","style","display:block;background:#39eb0400;",4,"ngIf"],[1,"card-body","d-flex","flex-column"],[1,"card-title","mb-1"],[1,"text-muted","small","mb-2"],["class","small mb-1",4,"ngIf"],[1,"fw-bold","fs-6","mt-auto"],[1,"btn","btn-link","btn-sm","mt-1",3,"click"],[1,"bi","bi-star-half","me-1"],[1,"btn","btn-outline-primary","btn-sm","mt-2",3,"click","disabled"],[1,"bi","bi-cart-plus","me-1"],["class","badge bg-secondary ms-2",4,"ngIf"],["class","badge bg-warning text-dark ms-2",4,"ngIf"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","#39eb0400"],[1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"fw-semibold"],[1,"text-muted","small"],[1,"me-2"],[1,"text-warning"],[4,"ngFor","ngForOf"],[1,"ms-2","text-muted"],["type","button",1,"btn-close",3,"click"],[1,"modal-body",2,"max-height","55vh","overflow","auto"],["class","mb-3 p-2 border rounded",4,"ngIf"],["class","text-center py-4",4,"ngIf"],["class","text-muted",4,"ngIf"],["class","list-group",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"mb-3","p-2","border","rounded"],[1,"mb-2"],[1,"text-warning",2,"cursor","pointer"],["rows","3","placeholder","Escribe tu opini\xF3n...",1,"form-control",3,"ngModelChange","ngModel"],[1,"mt-2","text-end"],[1,"btn","btn-primary","btn-sm",3,"click","disabled"],[3,"click"],[1,"text-center","py-4"],[1,"spinner-border"],[1,"text-muted"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex","justify-content-between"],[1,"mt-1"],[1,"small","mb-1"],[1,"ms-1"],[1,"badge","bg-secondary","ms-2"],[1,"badge","bg-warning","text-dark","ms-2"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"h4",1),p(2,"i",2),s(3,"Cat\xE1logo "),o(4,"span",3),s(5),r()(),o(6,"div",4)(7,"div",5)(8,"input",6),w("ngModelChange",function(u){return S(t.filtroNombre,u)||(t.filtroNombre=u),u}),g("ngModelChange",function(){return t.aplicarFiltro()}),r()(),o(9,"div",7)(10,"select",8),w("ngModelChange",function(u){return S(t.filtroCategoria,u)||(t.filtroCategoria=u),u}),g("change",function(){return t.aplicarFiltro()}),v(11,Vt,2,2,"option",9),r()()(),o(12,"div",10),v(13,Yt,21,13,"div",11),r()()),n&2&&(a(5),b(t.filtrados.length),a(3),y("ngModel",t.filtroNombre),a(2),y("ngModel",t.filtroCategoria),a(),d("ngForOf",t.categorias),a(2),d("ngForOf",t.filtrados))},dependencies:[T,D,F,L,K,X,O,J,R,A,ee],encapsulation:2})}}return i})();var Zt=()=>["/mis-productos/nuevo"],Jt=i=>["/mis-productos",i,"editar"];function Kt(i,m){i&1&&(o(0,"div",15),s(1," A\xFAn no tienes productos publicados. "),r())}function Xt(i,m){if(i&1&&(o(0,"div",16)(1,"div",17),p(2,"img",18),j(3,"imgUrl"),o(4,"div",19)(5,"div",20),s(6),r(),o(7,"h6",21),s(8),r(),o(9,"h6",21),s(10),r(),o(11,"div",22),s(12),r()(),o(13,"div",23)(14,"a",24),p(15,"i",25),r()()()()),i&2){let e=m.$implicit,n=c();a(2),d("src",Z(3,9,e.imagenUrl),U),a(4),W(" ",e.categoria," \xB7 ",e.estadoArticulo," "),a(),d("title",e.nombre),a(),b(e.nombre),a(),d("title",e.stock),a(),E(" En stock: ",e.stock,""),a(2),b(n.toQ(e.precioCents)),a(2),d("routerLink",ce(11,Jt,e.id))}}var et=(()=>{class i{constructor(){this.api=f(de),this.backendOrigin=x.backendOrigin??x.apiBase.replace(/\/api\/?$/,""),this.productos=[],this.pagina=0,this.tamanio=12,this.totalPaginas=0,this.total=0}ngOnInit(){this.cargar()}fullImg(e){let n=e?.imagenUrl??e?.imageUrl??null;return n?n.startsWith("/uploads/")?n:"/uploads/"+n.replace(/^\/+/,""):"assets/noimg.png"}cargar(){this.api.mis(this.pagina,this.tamanio).subscribe(e=>{this.productos=e.content,this.total=e.totalElements,this.totalPaginas=e.totalPages,this.pagina=e.number})}next(){this.pagina+1<this.totalPaginas&&(this.pagina++,this.cargar())}prev(){this.pagina>0&&(this.pagina--,this.cargar())}toQ(e){return e.toLocaleString("es-GT",{style:"currency",currency:"GTQ"})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-mis-productos"]],standalone:!0,features:[k],decls:18,vars:7,consts:[[1,"container","py-4"],[1,"d-flex","align-items-center","mb-3"],[1,"m-0"],[1,"bi","bi-box-seam","me-2"],[1,"badge","bg-primary","ms-2"],[1,"btn","btn-primary","ms-auto",3,"routerLink"],[1,"bi","bi-plus-circle","me-1"],[1,"row","g-3"],["class","col-12 text-muted",4,"ngIf"],["class","col-12 col-sm-6 col-md-4 col-lg-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end","mt-3"],[1,"btn","btn-outline-secondary","btn-sm","me-2",3,"click","disabled"],[1,"bi","bi-chevron-left"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-chevron-right"],[1,"col-12","text-muted"],[1,"col-12","col-sm-6","col-md-4","col-lg-3"],[1,"card","h-100","shadow-sm"],["loading","lazy","referrerpolicy","no-referrer",1,"card-img-top",2,"object-fit","cover",3,"src"],[1,"card-body"],[1,"small","text-muted","mb-1"],[1,"card-title","text-truncate",3,"title"],[1,"fw-semibold"],[1,"card-footer","bg-white","d-flex","gap-2"],[1,"btn","btn-outline-secondary","btn-sm",3,"routerLink"],[1,"bi","bi-pencil"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"h4",2),p(3,"i",3),s(4," Mis productos "),o(5,"span",4),s(6),r()(),o(7,"a",5),p(8,"i",6),s(9," Nuevo "),r()(),o(10,"div",7),v(11,Kt,2,0,"div",8)(12,Xt,16,13,"div",9),r(),o(13,"div",10)(14,"button",11),g("click",function(){return t.prev()}),p(15,"i",12),r(),o(16,"button",13),g("click",function(){return t.next()}),p(17,"i",14),r()()()),n&2&&(a(6),b(t.total),a(),d("routerLink",B(6,Zt)),a(4),d("ngIf",t.productos.length===0),a(),d("ngForOf",t.productos),a(2),d("disabled",t.pagina===0),a(2),d("disabled",t.pagina+1>=t.totalPaginas))},dependencies:[T,D,F,$,ee],encapsulation:2})}}return i})();function ei(i,m){if(i&1&&(o(0,"option",29),s(1),r()),i&2){let e=m.$implicit;d("value",e.id),a(),b(e.nombre)}}function ti(i,m){i&1&&(o(0,"span"),p(1,"i",30),s(2," Guardar"),r())}function ii(i,m){i&1&&p(0,"span",31)}function ni(i,m){if(i&1&&p(0,"img",32),i&2){let e=c();d("src",e.preview,U)}}function oi(i,m){i&1&&(o(0,"div",33),p(1,"i",34),r())}var Me=(()=>{class i{constructor(){this.route=f(fe),this.router=f(z),this.svc=f(de),this.http=f(V),this.titulo="Nuevo producto",this.cargando=!1,this.categorias=[],this.form={nombre:"",descripcion:"",precioCents:0,stock:1,estadoArticulo:"NUEVO",categoriaId:1},this.backendOrigin=x.backendOrigin??x.apiBase.replace(/\/api\/?$/,"")}ngOnInit(){this.id=Number(this.route.snapshot.paramMap.get("id"))||void 0,this.id&&(this.titulo="Editar producto"),this.http.get(`${x.apiBase}/catalogos/categorias`).subscribe({next:e=>this.categorias=e,error:e=>this.categorias=[{id:1,nombre:"Tecnolog\xEDa"},{id:2,nombre:"Hogar"},{id:3,nombre:"Acad\xE9mico"},{id:4,nombre:"Personal"},{id:5,nombre:"Decoraci\xF3n"},{id:6,nombre:"Otro"}]}),this.id&&this.svc.obtenerMio(this.id).subscribe(e=>{this.form={nombre:e.nombre,descripcion:e.descripcion,precioCents:e.precioCents,stock:e.stock,estadoArticulo:e.estadoArticulo,categoriaId:e.categoriaId??this.form.categoriaId};let n=e.imagenUrl??e.imageUrl??null;this.preview=n?this.backendOrigin+n:void 0})}onFile(e){let n=e.target.files?.[0];if(!n)return;this.imagenFile=n;let t=new FileReader;t.onload=()=>this.preview=t.result,t.readAsDataURL(n)}guardar(){if(this.cargando=!0,!this.form.nombre||!this.form.descripcion||this.form.precioCents<=0||this.form.stock<1){this.cargando=!1,alert("Completa los campos obligatorios");return}(this.id?this.svc.actualizar(this.id,this.form,this.imagenFile):this.svc.crear(this.form,this.imagenFile)).subscribe({next:n=>{this.cargando=!1,this.router.navigateByUrl("/mis-productos")},error:n=>{this.cargando=!1,alert(n?.error?.message??"Error al guardar")}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-producto-form"]],standalone:!0,features:[k],decls:57,vars:13,consts:[[1,"container","py-4",2,"max-width","920px"],[1,"mb-3"],[1,"bi","bi-box-seam","me-2"],[1,"row","g-3"],[1,"col-md-8"],[1,"card","shadow-sm"],[1,"card-body"],[1,"form-label"],["name","nombre","maxlength","140",1,"form-control",3,"ngModelChange","ngModel"],["rows","4","name","descripcion",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-4"],["type","number","name","precio",1,"form-control",3,"ngModelChange","ngModel"],["type","number","min","1","name","stock",1,"form-control",3,"ngModelChange","ngModel"],["name","estado",1,"form-select",3,"ngModelChange","ngModel"],["value","NUEVO"],["value","USADO"],[1,"row","g-3","mt-1"],[1,"col-md-6"],["name","categoriaId",1,"form-select",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"mt-3"],[1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],["class","spinner-border spinner-border-sm",4,"ngIf"],["type","file","accept","image/*",1,"form-control",3,"change"],[1,"mt-3","border","rounded","overflow-hidden",2,"height","220px"],["style","width:100%;height:100%;object-fit:cover;",3,"src",4,"ngIf"],["class","h-100 d-flex align-items-center justify-content-center bg-light",4,"ngIf"],[1,"text-muted","small","mt-2"],[3,"value"],[1,"bi","bi-check2","me-1"],[1,"spinner-border","spinner-border-sm"],[2,"width","100%","height","100%","object-fit","cover",3,"src"],[1,"h-100","d-flex","align-items-center","justify-content-center","bg-light"],[1,"bi","bi-image","fs-1","text-muted"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"h4",1),p(2,"i",2),s(3),r(),o(4,"div",3)(5,"div",4)(6,"div",5)(7,"div",6)(8,"div",1)(9,"label",7),s(10,"Nombre"),r(),o(11,"input",8),w("ngModelChange",function(u){return S(t.form.nombre,u)||(t.form.nombre=u),u}),r()(),o(12,"div",1)(13,"label",7),s(14,"Descripci\xF3n"),r(),o(15,"textarea",9),w("ngModelChange",function(u){return S(t.form.descripcion,u)||(t.form.descripcion=u),u}),r()(),o(16,"div",3)(17,"div",10)(18,"label",7),s(19,"Precio (quetzales)"),r(),o(20,"input",11),w("ngModelChange",function(u){return S(t.form.precioCents,u)||(t.form.precioCents=u),u}),r()(),o(21,"div",10)(22,"label",7),s(23,"Stock"),r(),o(24,"input",12),w("ngModelChange",function(u){return S(t.form.stock,u)||(t.form.stock=u),u}),r()(),o(25,"div",10)(26,"label",7),s(27,"Estado"),r(),o(28,"select",13),w("ngModelChange",function(u){return S(t.form.estadoArticulo,u)||(t.form.estadoArticulo=u),u}),o(29,"option",14),s(30,"Nuevo"),r(),o(31,"option",15),s(32,"Usado"),r()()()(),o(33,"div",16)(34,"div",17)(35,"label",7),s(36,"Categor\xEDa"),r(),o(37,"select",18),w("ngModelChange",function(u){return S(t.form.categoriaId,u)||(t.form.categoriaId=u),u}),v(38,ei,2,2,"option",19),r()()(),o(39,"div",20)(40,"button",21),g("click",function(){return t.guardar()}),v(41,ti,3,0,"span",22)(42,ii,1,0,"span",23),r()()()()(),o(43,"div",10)(44,"div",5)(45,"div",6)(46,"label",7),s(47,"Imagen principal"),r(),o(48,"input",24),g("change",function(u){return t.onFile(u)}),r(),o(49,"div",25),v(50,ni,1,1,"img",26)(51,oi,2,0,"div",27),r(),o(52,"div",28),s(53," Al guardar o actualizar, el producto quedar\xE1 "),o(54,"strong"),s(55,"en revisi\xF3n"),r(),s(56,". "),r()()()()()()),n&2&&(a(3),b(t.titulo),a(8),y("ngModel",t.form.nombre),a(4),y("ngModel",t.form.descripcion),a(5),y("ngModel",t.form.precioCents),a(4),y("ngModel",t.form.stock),a(4),y("ngModel",t.form.estadoArticulo),a(9),y("ngModel",t.form.categoriaId),a(),d("ngForOf",t.categorias),a(2),d("disabled",t.cargando),a(),d("ngIf",!t.cargando),a(),d("ngIf",t.cargando),a(8),d("ngIf",t.preview),a(),d("ngIf",!t.preview))},dependencies:[T,D,F,L,K,X,O,he,J,R,$e,_e,A],encapsulation:2})}}return i})();var ri=(i,m,e)=>({"border-success":i,"border-danger":m,"border-info":e}),ai=(i,m,e)=>({"bg-success text-white":i,"bg-danger text-white":m,"bg-info text-white":e});function si(i,m){i&1&&(o(0,"div",9),p(1,"div",10),r())}function li(i,m){i&1&&(o(0,"div",11),s(1," Tu carrito est\xE1 vac\xEDo. "),r())}function di(i,m){if(i&1){let e=M();o(0,"li",29)(1,"div",30),p(2,"img",31),j(3,"imgUrl"),o(4,"div",32)(5,"div",20),s(6),r(),o(7,"div",33),s(8),o(9,"b"),s(10),r()(),o(11,"div",33),s(12),r(),o(13,"div",34)(14,"button",35),g("click",function(){let t=h(e).$implicit,l=c(2);return _(l.dec(t))}),p(15,"i",36),r(),o(16,"span",37),s(17),r(),o(18,"button",38),g("click",function(){let t=h(e).$implicit,l=c(2);return _(l.inc(t))}),p(19,"i",39),r(),o(20,"button",40),g("click",function(){let t=h(e).$implicit,l=c(2);return _(l.remove(t))}),p(21,"i",41),r()()()()()}if(i&2){let e,n=m.$implicit,t=c(2);a(2),d("src",Z(3,7,(e=n.imagenUrl)!==null&&e!==void 0?e:null),U),a(4),b(n.nombre),a(2),E("",t.asQ(n.precio)," \xB7 Subtotal: "),a(2),b(t.asQ(n.subtotal)),a(2),E(" Quedan ",n.disponible,` en stock
`),a(5),b(n.cantidad),a(),d("disabled",n.disponible===0)}}function mi(i,m){if(i&1){let e=M();o(0,"li",52)(1,"button",53),g("click",function(){h(e);let t=c(3);return _(t.modo="guardada")}),s(2," Tarjetas guardadas "),r()()}if(i&2){let e=c(3);a(),ae("active",e.modo==="guardada")}}function ci(i,m){i&1&&(o(0,"div",11),s(1," No tienes tarjetas guardadas. Ingresa una nueva. "),r())}function pi(i,m){if(i&1){let e=M();o(0,"label",29)(1,"input",59),w("ngModelChange",function(t){h(e);let l=c(5);return S(l.tarjetaGuardadaId,t)||(l.tarjetaGuardadaId=t),_(t)}),r(),o(2,"span",60),s(3),r(),s(4),o(5,"span",61),s(6),r(),o(7,"div",62),s(8),r()()}if(i&2){let e=m.$implicit,n=c(5);a(),d("value",e.id),y("ngModel",n.tarjetaGuardadaId),a(2),b(e.marca),a(),E(" **** **** **** ",e.ultimos4," "),a(2),W("Vence ",e.expiracionMes,"/",e.expiracionAnio,""),a(2),E("Titular: ",e.titular,"")}}function ui(i,m){if(i&1&&(o(0,"div",58),v(1,pi,9,7,"label",16),r()),i&2){let e=c(4);a(),d("ngForOf",e.tarjetas)}}function gi(i,m){if(i&1&&(o(0,"div"),v(1,ci,2,0,"div",7)(2,ui,2,1,"div",57),r()),i&2){let e=c(3);a(),d("ngIf",!e.tarjetas.length),a(),d("ngIf",e.tarjetas.length)}}function fi(i,m){i&1&&(o(0,"div",79),s(1," Completa los datos de la tarjeta para continuar. "),r())}function hi(i,m){if(i&1){let e=M();o(0,"div")(1,"div",63)(2,"label",64),s(3,"N\xFAmero de tarjeta"),r(),o(4,"input",65),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.formNueva.numero,t)||(l.formNueva.numero=t),_(t)}),r(),o(5,"div",66),s(6,"Solo se usar\xE1 para obtener los \xFAltimos 4."),r()(),o(7,"div",67)(8,"div",68)(9,"label",64),s(10,"Marca"),r(),o(11,"select",69),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.formNueva.marca,t)||(l.formNueva.marca=t),_(t)}),o(12,"option"),s(13,"VISA"),r(),o(14,"option"),s(15,"MASTERCARD"),r(),o(16,"option"),s(17,"AMEX"),r()()(),o(18,"div",70)(19,"label",64),s(20,"Mes"),r(),o(21,"input",71),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.formNueva.mes,t)||(l.formNueva.mes=t),_(t)}),r()(),o(22,"div",70)(23,"label",64),s(24,"A\xF1o"),r(),o(25,"input",72),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.formNueva.anio,t)||(l.formNueva.anio=t),_(t)}),r()()(),o(26,"div",73)(27,"label",64),s(28,"Titular"),r(),o(29,"input",74),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.formNueva.titular,t)||(l.formNueva.titular=t),_(t)}),r()(),o(30,"div",75)(31,"input",76),w("ngModelChange",function(t){h(e);let l=c(3);return S(l.formNueva.guardar,t)||(l.formNueva.guardar=t),_(t)}),r(),o(32,"label",77),s(33,"Guardar esta tarjeta para futuras compras"),r()(),v(34,fi,2,0,"div",78),r()}if(i&2){let e=c(3);a(4),y("ngModel",e.formNueva.numero),a(7),y("ngModel",e.formNueva.marca),a(10),y("ngModel",e.formNueva.mes),a(4),y("ngModel",e.formNueva.anio),a(4),y("ngModel",e.formNueva.titular),a(2),y("ngModel",e.formNueva.guardar),a(3),d("ngIf",!e.nuevaValida)}}function _i(i,m){if(i&1){let e=M();o(0,"div",42)(1,"div",43)(2,"div",44)(3,"div",45)(4,"h5",46),p(5,"i",47),s(6," M\xE9todo de pago"),r(),o(7,"button",48),g("click",function(){h(e);let t=c(2);return _(t.cerrarPago())}),r()(),o(8,"div",49)(9,"ul",50),v(10,mi,3,2,"li",51),o(11,"li",52)(12,"button",53),g("click",function(){h(e);let t=c(2);return _(t.modo="nueva")}),s(13," Nueva tarjeta "),r()()(),v(14,gi,3,2,"div",25)(15,hi,35,7,"div",25),r(),o(16,"div",54)(17,"button",55),g("click",function(){h(e);let t=c(2);return _(t.cerrarPago())}),s(18,"Cancelar"),r(),o(19,"button",56),g("click",function(){h(e);let t=c(2);return _(t.pagar())}),s(20," Pagar "),r()()()()()}if(i&2){let e=c(2);a(10),d("ngIf",e.tarjetas.length),a(2),ae("active",e.modo==="nueva"),a(2),d("ngIf",e.modo==="guardada"),a(),d("ngIf",e.modo==="nueva"),a(4),d("disabled",e.modo==="nueva"&&!e.nuevaValida)}}function bi(i,m){if(i&1){let e=M();o(0,"div"),p(1,"div",80),o(2,"div",81)(3,"div",43)(4,"div",82)(5,"div",83)(6,"h5",46),s(7),r()(),o(8,"div",49)(9,"p",84),s(10),r()(),o(11,"div",54)(12,"button",85),g("click",function(){h(e);let t=c(2);return _(t.cerrarAlerta())}),s(13,"Aceptar"),r()()()()()()}if(i&2){let e=c(2);a(4),d("ngClass",we(4,ri,e.alerta.tipo==="success",e.alerta.tipo==="error",e.alerta.tipo==="info")),a(),d("ngClass",we(8,ai,e.alerta.tipo==="success",e.alerta.tipo==="error",e.alerta.tipo==="info")),a(2),b(e.alerta.titulo),a(3),b(e.alerta.mensaje)}}function vi(i,m){i&1&&p(0,"div",86)}function Ci(i,m){if(i&1){let e=M();o(0,"div",87)(1,"div",43)(2,"div",44)(3,"div",45)(4,"h6",46),s(5,"Confirmar"),r(),o(6,"button",48),g("click",function(){h(e);let t=c(2);return _(t.confirmNo())}),r()(),o(7,"div",49)(8,"p",2),s(9),r()(),o(10,"div",54)(11,"button",55),g("click",function(){h(e);let t=c(2);return _(t.confirmNo())}),s(12,"Cancelar"),r(),o(13,"button",88),g("click",function(){h(e);let t=c(2);return _(t.confirmYes())}),s(14,"Aceptar"),r()()()()()}if(i&2){let e=c(2);a(9),b(e.confirmText)}}function xi(i,m){if(i&1){let e=M();o(0,"div",12)(1,"div",13)(2,"div",14)(3,"ul",15),v(4,di,22,9,"li",16),r()()(),o(5,"div",17)(6,"div",14)(7,"div",18)(8,"div",19)(9,"span",20),s(10,"Total"),r(),o(11,"span",21),s(12),r()(),o(13,"button",22),g("click",function(){h(e);let t=c();return _(t.abrirPago())}),p(14,"i",23),s(15," Pagar ahora "),r(),v(16,_i,21,6,"div",24)(17,bi,14,12,"div",25)(18,vi,1,0,"div",26)(19,Ci,15,1,"div",27),o(20,"div",28),s(21," * M\xE9todo de pago: tarjeta. Entrega estimada en 5 d\xEDas. "),r()()()()()}if(i&2){let e=c();a(4),d("ngForOf",e.data.items),a(8),b(e.asQ(e.data.total)),a(),d("disabled",!e.data||e.data.items.length===0),a(3),d("ngIf",e.showPago),a(),d("ngIf",e.alerta.show),a(),d("ngIf",e.confirmOpen),a(),d("ngIf",e.confirmOpen)}}var tt=(()=>{class i{constructor(){this.svc=f(Ce),this.cargando=!1,this.backendOrigin=x.backendOrigin??x.apiBase.replace(/\/api\/?$/,""),this.alerta={show:!1,titulo:"",mensaje:"",tipo:"success",onClose:void 0,timeoutId:void 0},this.confirmOpen=!1,this.confirmText="",this.showPago=!1,this.tarjetas=[],this.modo="guardada",this.formNueva={numero:"",marca:"VISA",mes:"",anio:"",titular:"",guardar:!0}}mostrarAlerta(e,n,t="info",l=!1,u=0,C){this.alerta.timeoutId&&clearTimeout(this.alerta.timeoutId),this.alerta={show:!0,titulo:e,mensaje:n,tipo:t,onClose:C,timeoutId:void 0},l&&u>0&&(this.alerta.timeoutId=setTimeout(()=>this.cerrarAlerta(),u))}cerrarAlerta(){this.alerta.timeoutId&&clearTimeout(this.alerta.timeoutId);let e=this.alerta.onClose;this.alerta.show=!1,e&&e()}askConfirm(e){return this.confirmText=e,this.confirmOpen=!0,new Promise(n=>this.confirmResolver=n)}confirmYes(){this.confirmOpen=!1,this.confirmResolver?.(!0)}confirmNo(){this.confirmOpen=!1,this.confirmResolver?.(!1)}ngOnInit(){this.cargar()}imgSrc(e){let n=e?.imagenUrl??null;return n?n.startsWith("/uploads/")?n:"/uploads/"+n.replace(/^\/+/,""):"assets/noimg.png"}cargar(){this.cargando=!0,this.svc.ver().subscribe({next:e=>{this.data=e,this.cargando=!1},error:e=>{this.cargando=!1}})}inc(e){if(e.disponible===0){this.mostrarAlerta("Ya no hay m\xE1s unidades disponibles","info");return}this.svc.actualizar(e.productoId,e.cantidad+1).subscribe({next:n=>this.data=n,error:n=>this.mostrarAlerta(n?.error?.message||"No se pudo aumentar la cantidad","error")})}dec(e){let n=Math.max(1,e.cantidad-1);this.svc.actualizar(e.productoId,n).subscribe({next:t=>this.data=t,error:t=>this.mostrarAlerta(t?.error?.message||"No se pudo disminuir la cantidad","error")})}remove(e){this.svc.eliminar(e.productoId).subscribe({next:n=>{this.data=n,this.mostrarAlerta("Producto eliminado del carrito","info")},error:n=>this.mostrarAlerta(n?.error?.message||"No se pudo eliminar el producto","error")})}vaciar(){return Te(this,null,function*(){!this.data||this.data.items.length===0||!(yield this.askConfirm("\xBFVaciar carrito?"))||this.svc.vaciar().subscribe({next:n=>{this.cargar(),this.mostrarAlerta("Carrito vaciado","info")},error:n=>this.mostrarAlerta(n?.error?.message||"No se pudo vaciar el carrito","error")})})}agregarDesdeCatalogo(e){this.svc.agregar(e,1).subscribe({next:n=>{this.cargar(),this.mostrarAlerta("Agregado al carrito","success")},error:n=>this.mostrarAlerta(n?.error?.message||"No se pudo agregar: sin stock","error")})}asQ(e){return e.toLocaleString("es-GT",{style:"currency",currency:"GTQ"})}abrirPago(){!this.data||this.data.items.length===0||this.svc.tarjetas().subscribe(e=>{this.tarjetas=e,this.modo=this.tarjetas.length?"guardada":"nueva",this.tarjetaGuardadaId=this.tarjetas.length?this.tarjetas[0].id:void 0,this.showPago=!0})}cerrarPago(){this.showPago=!1}get nuevaValida(){let e=(this.formNueva.numero||"").replace(/\s+/g,""),n=Number(this.formNueva.mes),t=Number(this.formNueva.anio),l=(this.formNueva.titular||"").trim().length>=4,u=/^\d{13,19}$/.test(e),C=n>=1&&n<=12,ft=t>=2024&&t<=2100;return u&&C&&ft&&l}pagar(){if(!this.data||this.data.items.length===0)return;if(this.modo==="guardada"){if(!this.tarjetaGuardadaId){this.mostrarAlerta("Atenci\xF3n","Seleccione una tarjeta para continuar.","info",!1);return}this.svc.checkout({tarjetaGuardadaId:this.tarjetaGuardadaId}).subscribe({next:t=>{this.showPago=!1,this.mostrarAlerta("Pago aprobado",`Pedido #${t.pedidoId}`,"success",!1,0,()=>this.cargar())},error:t=>this.mostrarAlerta("Error",t?.error?.message||"No se pudo procesar el pago","error")});return}if(!this.nuevaValida){this.mostrarAlerta("Error","Revise los datos de la tarjeta","error",!1);return}let e=this.formNueva.numero.replace(/\s+/g,""),n={tokenPasarela:this.svc.simularTokenPasarela(),ultimos4:e.slice(-4),marca:this.formNueva.marca,expiracionMes:Number(this.formNueva.mes),expiracionAnio:Number(this.formNueva.anio),titular:this.formNueva.titular.trim(),guardarTarjeta:!!this.formNueva.guardar};this.svc.checkout(n).subscribe({next:t=>{this.showPago=!1,this.mostrarAlerta("Pago aprobado",`Pedido #${t.pedidoId}`,"success",!1,0,()=>this.cargar())},error:t=>this.mostrarAlerta("Error",t?.error?.message||"No se pudo procesar el pago","error")})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-carrito"]],standalone:!0,features:[k],decls:11,vars:4,consts:[[1,"container","py-4"],[1,"d-flex","align-items-center","mb-3"],[1,"m-0"],[1,"bi","bi-cart-check","me-2"],[1,"btn","btn-outline-danger","ms-auto",3,"click","disabled"],[1,"bi","bi-trash3","me-1"],["class","text-center py-5",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","row g-3",4,"ngIf"],[1,"text-center","py-5"],[1,"spinner-border"],[1,"alert","alert-info"],[1,"row","g-3"],[1,"col-12","col-lg-8"],[1,"card","shadow-sm"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"col-12","col-lg-4"],[1,"card-body"],[1,"d-flex","justify-content-between","mb-2"],[1,"fw-semibold"],[1,"fw-bold","fs-5"],[1,"btn","btn-primary","w-100",3,"click","disabled"],[1,"bi","bi-credit-card","me-1"],["class","modal fade show","tabindex","-1","style","display:block; background:rgba(0,0,0,.35);",4,"ngIf"],[4,"ngIf"],["class","modal-backdrop fade show","style","z-index:1050;",4,"ngIf"],["class","modal fade show d-block","tabindex","-1","style","z-index:1060;",4,"ngIf"],[1,"text-muted","small","mt-2"],[1,"list-group-item"],[1,"d-flex"],["loading","lazy","referrerpolicy","no-referrer",1,"card-img-top",2,"object-fit","cover",3,"src"],[1,"flex-grow-1"],[1,"text-muted","small"],[1,"mt-2","d-flex","align-items-center","gap-2"],[1,"btn","btn-sm","btn-outline-secondary",3,"click"],[1,"bi","bi-dash"],[1,"px-2"],[1,"btn","btn-sm","btn-outline-secondary",3,"click","disabled"],[1,"bi","bi-plus"],[1,"btn","btn-sm","btn-outline-danger","ms-auto",3,"click"],[1,"bi","bi-x-lg"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","rgba(0,0,0,.35)"],[1,"modal-dialog","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],[1,"bi","bi-credit-card","me-2"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"nav","nav-tabs","mb-3"],["class","nav-item",4,"ngIf"],[1,"nav-item"],[1,"nav-link",3,"click"],[1,"modal-footer"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-primary",3,"click","disabled"],["class","list-group",4,"ngIf"],[1,"list-group"],["type","radio","name","tg",1,"form-check-input","me-2",3,"ngModelChange","value","ngModel"],[1,"badge","bg-secondary","me-2"],[1,"text-muted","ms-2"],[1,"small","text-muted"],[1,"mb-3"],[1,"form-label"],["placeholder","4111 1111 1111 1111",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-text"],[1,"row"],[1,"col-6","mb-3"],[1,"form-select",3,"ngModelChange","ngModel"],[1,"col-3","mb-3"],["type","number","min","1","max","12","placeholder","MM",1,"form-control",3,"ngModelChange","ngModel"],["type","number","min","2024","max","2100","placeholder","YYYY",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-2"],["placeholder","Como aparece en la tarjeta",1,"form-control",3,"ngModelChange","ngModel"],[1,"form-check"],["id","guardar","type","checkbox",1,"form-check-input",3,"ngModelChange","ngModel"],["for","guardar",1,"form-check-label"],["class","alert alert-warning py-2 mt-3",4,"ngIf"],[1,"alert","alert-warning","py-2","mt-3"],[1,"modal-backdrop","fade","show",2,"z-index","1060","background","rgba(0,0,0,0.4)"],["tabindex","-1",1,"modal","fade","show","d-block","animate__animated","animate__fadeInDown",2,"z-index","1070"],[1,"modal-content","shadow-lg",3,"ngClass"],[1,"modal-header",3,"ngClass"],[1,"m-0","fs-6"],[1,"btn","btn-primary","px-4",3,"click"],[1,"modal-backdrop","fade","show",2,"z-index","1050"],["tabindex","-1",1,"modal","fade","show","d-block",2,"z-index","1060"],[1,"btn","btn-danger",3,"click"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"h4",2),p(3,"i",3),s(4," Carrito de compras"),r(),o(5,"button",4),g("click",function(){return t.vaciar()}),p(6,"i",5),s(7," Vaciar "),r()(),v(8,si,2,0,"div",6)(9,li,2,0,"div",7)(10,xi,22,7,"div",8),r()),n&2&&(a(5),d("disabled",!t.data||t.data.items.length===0),a(3),d("ngIf",t.cargando),a(),d("ngIf",t.data&&t.data.items.length===0),a(),d("ngIf",t.data&&t.data.items.length>0))},dependencies:[T,ue,D,F,L,K,X,O,he,Ue,J,Ge,R,_e,He,A,ee],encapsulation:2})}}return i})();var it=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/pedidos`}authHeaders(){let e=localStorage.getItem("token");return new ge({Authorization:`Bearer ${e}`,"Content-Type":"application/json"})}misPedidos(){return this.http.get(`${this.base}/mios`,{headers:this.authHeaders()})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function yi(i,m){i&1&&(o(0,"div",8),p(1,"div",9),r())}function Si(i,m){i&1&&(o(0,"div",10),s(1," A\xFAn no tienes compras realizadas. "),r())}function wi(i,m){if(i&1&&(o(0,"li",24)(1,"div",25),p(2,"img",26),j(3,"imgUrl"),o(4,"div",27)(5,"div",18),s(6),r(),o(7,"div",28),s(8),o(9,"b"),s(10),r()()()()()),i&2){let e,n=m.$implicit,t=c(3);a(2),d("src",Z(3,5,(e=n.imagenUrl)!==null&&e!==void 0?e:null),U),a(4),b(n.nombre),a(2),W(" ",n.cantidad," \xD7 ",t.asQ(n.precioUnitario)," \xB7 Subtotal: "),a(2),b(t.asQ(n.subtotal))}}function Ei(i,m){if(i&1&&(o(0,"div",13)(1,"h2",14)(2,"button",15)(3,"div",16)(4,"span")(5,"b"),s(6),r(),s(7),o(8,"span",17),s(9),r()(),o(10,"span",18),s(11),r()()()(),o(12,"div",19)(13,"div",20)(14,"div",21),s(15," Entrega estimada: "),o(16,"b"),s(17),r()(),o(18,"ul",22),v(19,wi,11,7,"li",23),r()()()()),i&2){let e=m.$implicit,n=m.index,t=c(2);a(),d("id","h"+n),a(),Se("data-bs-target","#c"+n),a(4),E("#",e.id,""),a(),E(" \xB7 ",t.fFecha(e.fecha)," "),a(2),b(e.estado),a(2),b(t.asQ(e.total)),a(),d("id","c"+n),Se("aria-labelledby","h"+n),a(5),b(t.fFecha(e.fechaEstimadaEntrega)||"\u2014"),a(2),d("ngForOf",e.items)}}function Mi(i,m){if(i&1&&(o(0,"div",11),v(1,Ei,20,10,"div",12),r()),i&2){let e=c();a(),d("ngForOf",e.pedidos)}}var nt=(()=>{class i{constructor(){this.api=f(it),this.backendOrigin=x.backendOrigin??x.apiBase.replace(/\/api\/?$/,""),this.pedidos=[],this.cargando=!1}ngOnInit(){this.cargar()}cargar(){this.cargando=!0,this.api.misPedidos().subscribe({next:e=>{this.pedidos=e,this.cargando=!1},error:e=>{this.cargando=!1}})}fullImg(e){return e?e.startsWith("/uploads/")?e:"/uploads/"+e.replace(/^\/+/,""):"assets/noimg.png"}asQ(e){return e.toLocaleString("es-GT",{style:"currency",currency:"GTQ"})}fFecha(e){return e?new Date(e).toLocaleDateString("es-GT",{year:"numeric",month:"short",day:"2-digit"}):""}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-mis-compras"]],standalone:!0,features:[k],decls:10,vars:4,consts:[[1,"container","py-4"],[1,"d-flex","align-items-center","mb-3"],[1,"m-0"],[1,"bi","bi-receipt","me-2"],[1,"badge","bg-primary","ms-2"],["class","text-center py-5",4,"ngIf"],["class","alert alert-info",4,"ngIf"],["class","accordion","id","accPedidos",4,"ngIf"],[1,"text-center","py-5"],[1,"spinner-border"],[1,"alert","alert-info"],["id","accPedidos",1,"accordion"],["class","accordion-item mb-2",4,"ngFor","ngForOf"],[1,"accordion-item","mb-2"],[1,"accordion-header",3,"id"],["type","button","data-bs-toggle","collapse",1,"accordion-button","collapsed"],[1,"w-100","d-flex","justify-content-between"],[1,"badge","bg-secondary","ms-2"],[1,"fw-semibold"],["data-bs-parent","#accPedidos",1,"accordion-collapse","collapse",3,"id"],[1,"accordion-body"],[1,"text-muted","small","mb-2"],[1,"list-group","list-group-flush"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"],[1,"d-flex"],["loading","lazy","referrerpolicy","no-referrer",1,"card-img-top",2,"object-fit","cover",3,"src"],[1,"flex-grow-1"],[1,"text-muted","small"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"h4",2),p(3,"i",3),s(4," Mis compras "),o(5,"span",4),s(6),r()()(),v(7,yi,2,0,"div",5)(8,Si,2,0,"div",6)(9,Mi,2,1,"div",7),r()),n&2&&(a(6),b(t.pedidos.length),a(),d("ngIf",t.cargando),a(),d("ngIf",!t.cargando&&t.pedidos.length===0),a(),d("ngIf",!t.cargando&&t.pedidos.length>0))},dependencies:[T,D,F,ee],encapsulation:2})}}return i})();var ot=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/moderador`}listarPendientes(e=0,n=12){return this.http.get(`${this.base}/solicitudes`,{params:{pagina:e,tamanio:n}})}aprobar(e){return this.http.post(`${this.base}/solicitudes/${e}/aprobar`,{})}rechazar(e,n){return this.http.post(`${this.base}/solicitudes/${e}/rechazar`,{motivo:n})}listarTodos(e=0,n=12){return this.http.get(`${this.base}/historial`,{params:{pagina:e,tamanio:n}})}listarHistorial(e=0,n=12){return this.http.get(`${this.base}/historial`,{params:{pagina:e,tamanio:n}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Ii(i,m){i&1&&(o(0,"div",18),p(1,"div",19),r())}function ki(i,m){if(i&1&&(o(0,"div",20),s(1),r()),i&2){let e=c();a(),E(" ",e.view==="pendientes"?"No hay productos pendientes.":"No hay productos en el historial."," ")}}function Ti(i,m){if(i&1&&(q(0),p(1,"img",32),Y()),i&2){let e=m.ngIf;a(),d("src",e,U)}}function Fi(i,m){i&1&&(o(0,"div",33),p(1,"i",34),r())}function Pi(i,m){if(i&1&&(o(0,"div",35)(1,"span",36),s(2),r()()),i&2){let e=c().$implicit;a(),ae("bg-success",e.estadoMod==="APROBADO")("bg-danger",e.estadoMod==="RECHAZADO")("bg-secondary",e.estadoMod!=="APROBADO"&&e.estadoMod!=="RECHAZADO"),a(),E(" ",e.estadoMod," ")}}function Vi(i,m){if(i&1&&(o(0,"div",37),p(1,"i",38),s(2),r()),i&2){let e=c().$implicit;a(2),E(" Motivo: ",e.comentarioRechazo," ")}}function Ni(i,m){if(i&1){let e=M();o(0,"div",39)(1,"button",40),g("click",function(){h(e);let t=c().$implicit,l=c();return _(l.aprobar(t))}),p(2,"i",41),s(3," Aprobar "),r(),o(4,"button",42),g("click",function(){h(e);let t=c().$implicit,l=c();return _(l.abrirRechazo(t))}),p(5,"i",43),s(6," Rechazar "),r()()}}function Oi(i,m){if(i&1&&(o(0,"div",21)(1,"div",22),v(2,Ti,2,1,"ng-container",23)(3,Fi,2,0,"ng-template",null,0,pe),o(5,"div",24)(6,"div",25),s(7),r(),o(8,"div",26),s(9),r(),o(10,"div",27),s(11),r(),o(12,"div",28),s(13),j(14,"currency"),r(),v(15,Pi,3,7,"div",29)(16,Vi,3,1,"div",30),r(),v(17,Ni,7,0,"div",31),r()()),i&2){let e=m.$implicit,n=H(4),t=c();a(2),d("ngIf",t.fullImg(e))("ngIfElse",n),a(5),W("",e.categoria," \xB7 ",e.vendedorNombre,""),a(),d("title",e.nombre),a(),b(e.nombre),a(2),E("Stock: ",e.stock,""),a(2),b(ie(14,11,e.precioCents||0,"GTQ")),a(2),d("ngIf",t.view==="historial"),a(),d("ngIf",e.estadoMod==="RECHAZADO"&&e.comentarioRechazo),a(),d("ngIf",t.view==="pendientes")}}function Ri(i,m){if(i&1){let e=M();o(0,"div",44)(1,"div",45)(2,"div",46)(3,"div",47)(4,"strong"),s(5,"Rechazar producto"),r(),o(6,"button",48),g("click",function(){h(e);let t=c();return _(t.cerrarRechazo())}),r()(),o(7,"div",49)(8,"label",50),s(9,"Motivo"),r(),o(10,"textarea",51),w("ngModelChange",function(t){h(e);let l=c();return S(l.motivoRechazo,t)||(l.motivoRechazo=t),_(t)}),r()(),o(11,"div",52)(12,"button",53),g("click",function(){h(e);let t=c();return _(t.cerrarRechazo())}),s(13,"Cancelar"),r(),o(14,"button",54),g("click",function(){h(e);let t=c();return _(t.rechazar())}),s(15,"Rechazar"),r()()()()()}if(i&2){let e=c();a(10),y("ngModel",e.motivoRechazo)}}var rt=(()=>{class i{constructor(){this.api=f(ot),this.auth=f(Q),this.backendOrigin=x.backendOrigin??x.apiBase.replace(/\/api\/?$/,""),this.lista=[],this.pagina=0,this.tamanio=12,this.totalPaginas=0,this.cargando=!1,this.motivoRechazo="",this.showRechazar=!1,this.view="pendientes"}ngOnInit(){this.cargar()}fullImg(e){return e.imagenUrl?this.backendOrigin+e.imagenUrl:null}cambiarVista(e){this.view=e,this.pagina=0,this.cargar()}cargar(){this.cargando=!0;let e=()=>this.cargando=!1;(this.view==="pendientes"?this.api.listarPendientes(this.pagina,this.tamanio):this.api.listarHistorial(this.pagina,this.tamanio)).subscribe({next:t=>{this.lista=t.content,this.totalPaginas=t.totalPages,this.pagina=t.number,e()},error:()=>e()})}aprobar(e){confirm(`Aprobar "${e.nombre}"?`)&&this.api.aprobar(e.id).subscribe(n=>this.cargar())}abrirRechazo(e){this.idRechazo=e.id,this.motivoRechazo="",this.showRechazar=!0}cerrarRechazo(){this.showRechazar=!1}rechazar(){if(this.idRechazo){if(!this.motivoRechazo.trim()){alert("Indica un motivo");return}this.api.rechazar(this.idRechazo,this.motivoRechazo).subscribe(e=>{this.showRechazar=!1,this.cargar()})}}next(){this.pagina+1<this.totalPaginas&&(this.pagina++,this.cargar())}prev(){this.pagina>0&&(this.pagina--,this.cargar())}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-moderador-solicitudes"]],standalone:!0,features:[k],decls:24,vars:15,consts:[["noimg",""],[1,"container","py-4"],[1,"m-0"],[1,"bi","bi-person-badge","me-2"],[1,"fw-semibold","text-primary"],[1,"mb-3"],[1,"bi","bi-shield-check","me-2"],[1,"d-flex","gap-2","mb-3"],[1,"btn",3,"click"],["class","text-center py-5",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"row","g-3"],["class","col-md-3",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end","gap-2","mt-3"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-chevron-left"],[1,"bi","bi-chevron-right"],["class","modal fade show","tabindex","-1","style","display:block;background:rgba(0,0,0,.2);",4,"ngIf"],[1,"text-center","py-5"],[1,"spinner-border"],[1,"text-muted"],[1,"col-md-3"],[1,"card","h-100","shadow-sm"],[4,"ngIf","ngIfElse"],[1,"card-body"],[1,"small","text-muted"],[1,"fw-semibold","text-truncate",3,"title"],[1,"small"],[1,"fw-bold","mt-1"],["class","mt-2",4,"ngIf"],["class","mt-2 small text-danger",4,"ngIf"],["class","card-footer d-flex gap-2 bg-white",4,"ngIf"],[1,"card-img-top",2,"object-fit","cover",3,"src"],[1,"bg-light","d-flex","align-items-center","justify-content-center",2,"height","180px"],[1,"bi","bi-image","fs-1","text-muted"],[1,"mt-2"],[1,"badge"],[1,"mt-2","small","text-danger"],[1,"bi","bi-info-circle","me-1"],[1,"card-footer","d-flex","gap-2","bg-white"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"bi","bi-check2"],[1,"btn","btn-outline-danger","btn-sm",3,"click"],[1,"bi","bi-x"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","rgba(0,0,0,.2)"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-label"],["rows","3",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(n,t){n&1&&(o(0,"div",1)(1,"h6",2),p(2,"i",3),s(3," Bienvenido "),o(4,"span",4),s(5),r()(),o(6,"h4",5),p(7,"i",6),s(8,"Solicitudes de moderaci\xF3n"),r(),o(9,"div",7)(10,"button",8),g("click",function(){return t.cambiarVista("pendientes")}),s(11," Pendientes "),r(),o(12,"button",8),g("click",function(){return t.cambiarVista("historial")}),s(13," Aprobados / Rechazados "),r()(),v(14,Ii,2,0,"div",9)(15,ki,2,1,"div",10),o(16,"div",11),v(17,Oi,18,14,"div",12),r(),o(18,"div",13)(19,"button",14),g("click",function(){return t.prev()}),p(20,"i",15),r(),o(21,"button",14),g("click",function(){return t.next()}),p(22,"i",16),r()()(),v(23,Ri,16,1,"div",17)),n&2&&(a(5),b(t.auth.nombre||"moderador"),a(5),ae("btn-primary",t.view==="pendientes")("btn-outline-primary",t.view!=="pendientes"),a(2),ae("btn-primary",t.view==="historial")("btn-outline-primary",t.view!=="historial"),a(2),d("ngIf",t.cargando),a(),d("ngIf",!t.cargando&&t.lista.length===0),a(2),d("ngForOf",t.lista),a(2),d("disabled",t.pagina===0),a(2),d("disabled",t.pagina+1>=t.totalPaginas),a(2),d("ngIf",t.showRechazar))},dependencies:[T,D,F,se,L,O,R,A],encapsulation:2})}}return i})();var at=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/ganancias`}resumen(){return this.http.get(`${this.base}/resumen`)}listar(e=0,n=12){return this.http.get(this.base,{params:{pagina:e,tamanio:n}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Ai(i,m){if(i&1&&(o(0,"div",10)(1,"div",11)(2,"div",12)(3,"div",13)(4,"div",14),s(5,"Total ganado"),r(),o(6,"div",15),s(7),r()()()(),o(8,"div",11)(9,"div",12)(10,"div",13)(11,"div",14),s(12,"Hoy"),r(),o(13,"div",15),s(14),r(),o(15,"div",16),s(16),r()()()(),o(17,"div",11)(18,"div",12)(19,"div",13)(20,"div",14),s(21,"Este mes"),r(),o(22,"div",15),s(23),r(),o(24,"div",16),s(25),r()()()()()),i&2){let e=c();a(7),b(e.asQ(e.r.totalNeto)),a(7),b(e.asQ(e.r.netoHoy)),a(2),E("",e.r.ventasHoy," ventas"),a(7),b(e.asQ(e.r.netoMes)),a(2),E("",e.r.ventasMes," ventas")}}function Li(i,m){if(i&1&&(o(0,"div",17)(1,"div",18),p(2,"img",19),j(3,"imgUrl"),o(4,"div",13)(5,"div",16),s(6),r(),o(7,"div",20),s(8),r(),o(9,"div",21),s(10),r(),o(11,"div",16),s(12),r(),o(13,"div",22)(14,"div",21),s(15),r(),o(16,"div",21),s(17),r(),o(18,"div",23),s(19),r()()()()()),i&2){let e,n=m.$implicit,t=c();a(2),d("src",Z(3,11,(e=n.imagenUrl)!==null&&e!==void 0?e:null),U),a(4),W("",t.fFecha(n.fecha)," \xB7 Pedido #",n.pedidoId,""),a(),d("title",n.productoNombre),a(),b(n.productoNombre),a(2),W("Cantidad: ",n.cantidad," \xB7 Precio unitario: ",t.asQ(n.precioUnitario),""),a(2),E("Estado: ",n.estadoPedido,""),a(3),E("Subtotal: ",t.asQ(n.subtotal),""),a(2),E("Comisi\xF3n Aplicaci\xF3n (5%): ",t.asQ(n.comision),""),a(2),E("Tu neto (95%): ",t.asQ(n.netoVendedor),"")}}var st=(()=>{class i{constructor(){this.api=f(at),this.backendOrigin=x.backendOrigin??x.apiBase.replace(/\/api\/?$/,""),this.lista=[],this.pagina=0,this.tamanio=12,this.totalPaginas=0,this.cargando=!1}ngOnInit(){this.cargar()}fullImg(e){let n=e??null;return n?n.startsWith("/uploads/")?n:"/uploads/"+n.replace(/^\/+/,""):"assets/noimg.png"}asQ(e){return e.toLocaleString("es-GT",{style:"currency",currency:"GTQ"})}fFecha(e){return new Date(e).toLocaleDateString("es-GT",{year:"numeric",month:"short",day:"2-digit"})}cargar(){this.cargando=!0,this.api.resumen().subscribe(e=>this.r=e),this.api.listar(this.pagina,this.tamanio).subscribe(e=>{this.lista=e.content,this.totalPaginas=e.totalPages,this.pagina=e.number,this.cargando=!1},e=>this.cargando=!1)}next(){this.pagina+1<this.totalPaginas&&(this.pagina++,this.cargar())}prev(){this.pagina>0&&(this.pagina--,this.cargar())}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-mis-ganancias"]],standalone:!0,features:[k],decls:12,vars:4,consts:[[1,"container","py-4"],[1,"mb-3"],[1,"bi","bi-cash-coin","me-2"],["class","row g-3 mb-3",4,"ngIf"],[1,"row","g-3"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end","gap-2","mt-3"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-chevron-left"],[1,"bi","bi-chevron-right"],[1,"row","g-3","mb-3"],[1,"col-sm-6","col-md-3"],[1,"card","shadow-sm"],[1,"card-body"],[1,"text-muted","small"],[1,"fs-5","fw-semibold"],[1,"small","text-muted"],[1,"col-md-4"],[1,"card","h-100","shadow-sm"],["loading","lazy","referrerpolicy","no-referrer",1,"card-img-top",2,"object-fit","cover",3,"src"],[1,"fw-semibold","text-truncate",3,"title"],[1,"small"],[1,"mt-2"],[1,"fw-semibold"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"h4",1),p(2,"i",2),s(3," Mis ganancias"),r(),v(4,Ai,26,5,"div",3),o(5,"div",4),v(6,Li,20,13,"div",5),r(),o(7,"div",6)(8,"button",7),g("click",function(){return t.prev()}),p(9,"i",8),r(),o(10,"button",7),g("click",function(){return t.next()}),p(11,"i",9),r()()()),n&2&&(a(4),d("ngIf",t.r),a(2),d("ngForOf",t.lista),a(2),d("disabled",t.pagina===0),a(2),d("disabled",t.pagina+1>=t.totalPaginas))},dependencies:[T,D,F,ee],encapsulation:2})}}return i})();var lt=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/logistica`}enCurso(e=0,n=12){return this.http.get(`${this.base}/en-curso`,{params:{pagina:e,tamanio:n}})}actualizarFechaEntrega(e,n){return this.http.put(`${this.base}/${e}/fecha-entrega`,null,{params:{fecha:n}})}marcarEntregado(e){return this.http.post(`${this.base}/${e}/entregar`,{})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();function Wi(i,m){i&1&&(o(0,"div",15),p(1,"div",16),r())}function Bi(i,m){i&1&&(o(0,"div",17),s(1,"No hay pedidos en curso."),r())}function ji(i,m){if(i&1){let e=M();o(0,"div",18)(1,"div",19)(2,"div",20)(3,"div",21),s(4),r(),o(5,"div",22),s(6),r(),o(7,"div"),s(8),j(9,"date"),r(),o(10,"div",23),s(11,"Entrega: "),o(12,"b"),s(13),j(14,"date"),r()(),o(15,"div",24),s(16),j(17,"currency"),r()(),o(18,"div",25)(19,"button",26),g("click",function(){let t=h(e).$implicit,l=c();return _(l.abrirFecha(t))}),p(20,"i",27),s(21," Reprogramar "),r(),o(22,"button",28),g("click",function(){let t=h(e).$implicit,l=c();return _(l.entregar(t))}),p(23,"i",29),s(24," Entregado "),r()()()()}if(i&2){let e=m.$implicit;a(4),W("#",e.id," \xB7 ",e.estadoCodigo,""),a(2),b(e.compradorNombre),a(2),E("Creado: ",ie(9,6,e.fechaCreacion,"medium"),""),a(5),b(ie(14,9,e.fechaEstimadaEntrega,"mediumDate")),a(3),E("Total: ",ie(17,12,e.totalBruto,"GTQ"),"")}}function Di(i,m){if(i&1){let e=M();o(0,"div",30)(1,"div",31)(2,"div",32)(3,"div",33)(4,"strong"),s(5,"Reprogramar entrega"),r(),o(6,"button",34),g("click",function(){h(e);let t=c();return _(t.editId=void 0)}),r()(),o(7,"div",35)(8,"label",36),s(9,"Nueva fecha"),r(),o(10,"input",37),w("ngModelChange",function(t){h(e);let l=c();return S(l.nuevaFecha,t)||(l.nuevaFecha=t),_(t)}),r()(),o(11,"div",38)(12,"button",39),g("click",function(){h(e);let t=c();return _(t.editId=void 0)}),s(13,"Cancelar"),r(),o(14,"button",40),g("click",function(){h(e);let t=c();return _(t.guardarFecha())}),s(15,"Guardar"),r()()()()()}if(i&2){let e=c();a(10),y("ngModel",e.nuevaFecha)}}var dt=(()=>{class i{constructor(){this.api=f(lt),this.auth=f(Q),this.lista=[],this.pagina=0,this.tamanio=12,this.totalPaginas=0,this.cargando=!1,this.nuevaFecha=""}ngOnInit(){this.cargar()}cargar(){this.cargando=!0,this.api.enCurso(this.pagina,this.tamanio).subscribe({next:e=>{this.lista=e.content,this.totalPaginas=e.totalPages,this.pagina=e.number,this.cargando=!1},error:e=>this.cargando=!1})}abrirFecha(e){this.editId=e.id,this.nuevaFecha=(e.fechaEstimadaEntrega??"").substring(0,10)}guardarFecha(){!this.editId||!this.nuevaFecha||this.api.actualizarFechaEntrega(this.editId,this.nuevaFecha).subscribe({next:e=>{this.editId=void 0,this.cargar()},error:e=>alert("No se pudo reprogramar la entrega")})}entregar(e){confirm(`Marcar como ENTREGADO el pedido #${e.id}?`)&&this.api.marcarEntregado(e.id).subscribe({next:n=>this.cargar(),error:n=>alert("No se pudo marcar como entregado")})}next(){this.pagina+1<this.totalPaginas&&(this.pagina++,this.cargar())}prev(){this.pagina>0&&(this.pagina--,this.cargar())}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-logistica-pendientes"]],standalone:!0,features:[k],decls:19,vars:7,consts:[[1,"container","py-4"],[1,"m-0"],[1,"bi","bi-person-badge","me-2"],[1,"fw-semibold","text-primary"],[1,"mb-3"],[1,"bi","bi-truck","me-2"],["class","text-center py-5",4,"ngIf"],["class","text-muted",4,"ngIf"],[1,"row","g-3"],["class","col-md-4",4,"ngFor","ngForOf"],[1,"d-flex","justify-content-end","gap-2","mt-3"],[1,"btn","btn-outline-secondary","btn-sm",3,"click","disabled"],[1,"bi","bi-chevron-left"],[1,"bi","bi-chevron-right"],["class","modal fade show","tabindex","-1","style","display:block;background:rgba(0,0,0,.2);",4,"ngIf"],[1,"text-center","py-5"],[1,"spinner-border"],[1,"text-muted"],[1,"col-md-4"],[1,"card","h-100","shadow-sm"],[1,"card-body"],[1,"small","text-muted"],[1,"fw-semibold"],[1,"mb-1"],[1,"fw-bold"],[1,"card-footer","bg-white","d-flex","gap-2"],[1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-calendar-event"],[1,"btn","btn-success","btn-sm","ms-auto",3,"click"],[1,"bi","bi-check2-circle"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","rgba(0,0,0,.2)"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],[1,"btn-close",3,"click"],[1,"modal-body"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-primary",3,"click"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"h6",1),p(2,"i",2),s(3," Bienvenido "),o(4,"span",3),s(5),r()(),o(6,"h4",4),p(7,"i",5),s(8,"Pedidos en curso"),r(),v(9,Wi,2,0,"div",6)(10,Bi,2,0,"div",7),o(11,"div",8),v(12,ji,25,15,"div",9),r(),o(13,"div",10)(14,"button",11),g("click",function(){return t.prev()}),p(15,"i",12),r(),o(16,"button",11),g("click",function(){return t.next()}),p(17,"i",13),r()()(),v(18,Di,16,1,"div",14)),n&2&&(a(5),b(t.auth.nombre||"logistica"),a(4),d("ngIf",t.cargando),a(),d("ngIf",!t.cargando&&t.lista.length===0),a(2),d("ngForOf",t.lista),a(2),d("disabled",t.pagina===0),a(2),d("disabled",t.pagina+1>=t.totalPaginas),a(2),d("ngIf",t.editId))},dependencies:[T,D,F,se,Re,L,O,R,A],encapsulation:2})}}return i})();var mt=(()=>{class i{constructor(){this.http=f(V),this.base=`${x.apiBase}/admin/ganancias`}obtener(e,n){return this.http.get(this.base,{params:{desde:e,hasta:n}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var zi=()=>["/admin/empleados"],ct=(()=>{class i{constructor(){this.api=f(mt),this.desde=this.hoy(),this.hasta=this.hoy(),this.total=0}ngOnInit(){this.filtrar()}filtrar(){this.api.obtener(this.desde,this.hasta).subscribe({next:e=>this.total=e.total??0,error:e=>this.total=0})}hoy(){return new Date().toISOString().substring(0,10)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=I({type:i,selectors:[["app-ganancias-admin"]],standalone:!0,features:[k],decls:27,vars:8,consts:[[1,"container","py-4"],[1,"d-flex","justify-content-between","align-items-center","mb-3"],[1,"bi","bi-cash-coin","me-2"],[1,"btn","btn-outline-secondary","btn-sm","fw-semibold",3,"routerLink"],[1,"bi","bi-arrow-left-circle","me-1"],[1,"row","g-2","align-items-end","mb-3"],[1,"col-md-3"],[1,"form-label"],["type","date",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-2"],[1,"btn","btn-primary","w-100",3,"click"],[1,"card"],[1,"card-body"],[1,"display-5","fw-bold"],[1,"text-muted"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"h4"),p(3,"i",2),s(4,"Ganancias de la plataforma (5%)"),r(),o(5,"a",3),p(6,"i",4),s(7," Regresar "),r()(),o(8,"div",5)(9,"div",6)(10,"label",7),s(11,"Desde"),r(),o(12,"input",8),w("ngModelChange",function(u){return S(t.desde,u)||(t.desde=u),u}),r()(),o(13,"div",6)(14,"label",7),s(15,"Hasta"),r(),o(16,"input",8),w("ngModelChange",function(u){return S(t.hasta,u)||(t.hasta=u),u}),r()(),o(17,"div",9)(18,"button",10),g("click",function(){return t.filtrar()}),s(19,"Filtrar"),r()()(),o(20,"div",11)(21,"div",12)(22,"div",13),s(23),j(24,"currency"),r(),o(25,"div",14),s(26,"Suma del 5% de todas las ventas del rango."),r()()()()),n&2&&(a(5),d("routerLink",B(7,zi)),a(7),y("ngModel",t.desde),a(4),y("ngModel",t.hasta),a(7),b(ie(24,4,t.total,"GTQ")))},dependencies:[T,se,L,O,R,A,$],encapsulation:2})}}return i})();var pt=[{path:"login",component:qe},{path:"register",component:Ye},{path:"inicio",component:Xe},{path:"admin",canMatch:[Ze],children:[{path:"empleados",component:Je},{path:"empleados/crear",component:Ee},{path:"",redirectTo:"empleados",pathMatch:"full"}]},{path:"mis-productos",component:et},{path:"mis-productos/nuevo",component:Me},{path:"mis-productos/:id/editar",component:Me},{path:"carrito",component:tt},{path:"mis-compras",component:nt},{path:"moderador/solicitudes",component:rt},{path:"logistica/pendientes",component:dt},{path:"admin/empleados/:id/editar",component:Ee},{path:"mis-ganancias",component:st},{path:"admin/ganancias",component:ct},{path:"admin/reportes",loadComponent:()=>import("./chunk-ZKW4OIJ4.js").then(i=>i.AdminReportesComponent)},{path:"",pathMatch:"full",redirectTo:"login"},{path:"**",redirectTo:"login"}];var ut=(i,m)=>{let e=localStorage.getItem("token"),n=i.url.startsWith("/api")||x.apiBase&&i.url.startsWith(x.apiBase),t=i.url.includes("/auth/")||x.apiBase&&i.url.startsWith(x.apiBase+"/auth/"),l={"ngrok-skip-browser-warning":"true"};return e&&n&&!t&&(l.Authorization=`Bearer ${e}`),i=i.clone({setHeaders:l}),m(i)};var gt={providers:[ze(pt),Le(We([ut]))]};Be(Qe,gt).catch(i=>console.error(i));
